<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><title>たのしいHaskellのツールチェインとC++</title><meta charset="utf-8"><script src="pfi-seminar-2012-07-19_files/slides.txt"></script><style></style><style>table.sourceCode,tr.sourceCode,td.lineNumbers,td.sourceCode,table.sourceCode pre{margin:0;padding:0;border:0;vertical-align:baseline;border:none}td.lineNumbers{border-right:1px solid #AAAAAA;text-align:right;color:#AAAAAA;padding-right:5px;padding-left:5px}td.sourceCode{padding-left:5px}code.sourceCode span.kw{color:#007020;font-weight:bold}code.sourceCode span.dt{color:#902000}code.sourceCode span.dv{color:#40a070}code.sourceCode span.bn{color:#40a070}code.sourceCode span.fl{color:#40a070}code.sourceCode span.ch{color:#4070a0}code.sourceCode span.st{color:#4070a0}code.sourceCode span.co{color:#60a0b0;font-style:italic}code.sourceCode span.ot{color:#007020}code.sourceCode span.al{color:red;font-weight:bold}code.sourceCode span.fu{color:#06287e}code.sourceCode span.er{color:red;font-weight:bold}</style><meta content="width=1100,height=750" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"></head><body class="loaded" style="display: none"><section class="slides layout-regular "><article class="current"><h1>たのしいHaskellのツールチェインとC++</h1><p>田中英行 <a href="mailto:tanakh@preferred.jp" alt=""></a><a href="mailto:tanakh@preferred.jp">&lt;tanakh@preferred.jp&gt;</a></p><p>PFIセミナー 2012/07/19</p></article><article class="next"><h3>自己紹介</h3><ul><li><p>田中英行, <a href="http://twitter.com/tanakh" alt="">@tanakh</a>, <a href="http://tanakh.jp/" alt=""></a><a href="http://tanakh.jp/">http://tanakh.jp</a></p></li><li><p>PFIで働くプログラマ</p></li><li><p>Haskell愛好家</p><ul><li><p>拙訳「すごいHaskellたのしく学ぼう! 」発売中</p><iframe class="mqomoxpoctlqqwsmgrgj" src="pfi-seminar-2012-07-19_files/cm.htm" style="width:120px;height:240px;" marginwidth="0" marginheight="0" frameborder="0" scrolling="no"></iframe></li></ul></li></ul></article><article class="far-next"><h3>本日の概要</h3><ul><li><p>ソフトウェアテストを取り巻く環境</p></li><li><p>C/C++のコードをQuickCheckする</p></li><li><p>C/C++のコードをCriterionでパフォーマンス測定する</p></li></ul></article><article><h2>テスト駆動開発</h2></article><article><h3>Not enough!</h3><p><img class="centered" src="pfi-seminar-2012-07-19_files/ne.png" alt=""></p><div class="source">
    <a href="http://blog.fogus.me/2012/06/20/not-enough/" alt=""></a><a href="http://blog.fogus.me/2012/06/20/not-enough/">http://blog.fogus.me/2012/06/20/not-enough/</a><div>
</div></div></article><article><p><img class="centered" src="pfi-seminar-2012-07-19_files/notenough.png" alt=""></p><div class="source">
    <a href="http://evanfarrer.blogspot.ca/2012/06/unit-testing-isnt-enough-you-need.html" alt=""></a><a href="http://evanfarrer.blogspot.ca/2012/06/unit-testing-isnt-enough-you-need.html">http://evanfarrer.blogspot.ca/2012/06/unit-testing-isnt-enough-you-need.html</a><div>

</div></div></article><article><h3>Static typing is not enough!</h3><p><img class="centered" src="pfi-seminar-2012-07-19_files/stine.png" alt=""></p><div class="source">
    <a href="http://blog.fogus.me/2012/06/20/not-enough/" alt=""></a><a href="http://blog.fogus.me/2012/06/20/not-enough/">http://blog.fogus.me/2012/06/20/not-enough/</a><div>
</div></div></article><article><h3>Contracts are not enough!</h3><p><img class="centered" src="pfi-seminar-2012-07-19_files/cane.png" alt=""></p><div class="source">
    <a href="http://blog.fogus.me/2012/06/20/not-enough/" alt=""></a><a href="http://blog.fogus.me/2012/06/20/not-enough/">http://blog.fogus.me/2012/06/20/not-enough/</a><div>
</div></div></article><article><h3>XX are not enough!</h3><p><img class="centered" src="pfi-seminar-2012-07-19_files/nes.png" alt=""></p><p>（オチがそれかよ…）</p></article><article><h3>絶対にバグのないプログラムを書く方法</h3><p><img class="centered" src="pfi-seminar-2012-07-19_files/pdd.png" alt=""></p><div class="source">
    <a href="http://www.iij-ii.co.jp/lab/techdoc/coqt/" alt=""></a><a href="http://www.iij-ii.co.jp/lab/techdoc/coqt/">http://www.iij-ii.co.jp/lab/techdoc/coqt/</a><div>

</div></div></article><article><h3>一般的な話</h3><ul><li><a href="http://en.wikipedia.org/wiki/Software_testing" alt="">テスト</a>はプログラムの正しさを <strong>保証しない</strong></li><li><p><a href="http://en.wikipedia.org/wiki/Design_by_contract" alt="">契約</a>（Contract）はプログラムの正しさを <strong>保証しない</strong></p></li><li><a href="http://en.wikipedia.org/wiki/Type_system" alt="">型</a>はプログラムの正しさを <strong>保証しない</strong> が、<ul><li>ある種の性質は保証できる</li></ul></li></ul><br><ul><li><a href="http://en.wikipedia.org/wiki/Interactive_theorem_proving" alt="">証明</a>はプログラムの正しさを <strong>証明する</strong></li></ul></article><article><h3>定理証明系</h3><ul><li><p>定理証明 ⇒ Fully Dependent Typedなプログラミング言語でプログラムを書く</p><ul><li><a href="http://coq.inria.fr/" alt="">Coq</a> / <a href="http://wiki.portal.chalmers.se/agda/pmwiki.php" alt="">Agda2</a></li></ul></li><li><p>実は、ある型のプログラムを書くことは、ある命題の証明と対応する！</p><ul><li><a href="http://en.wikipedia.org/wiki/Curry%E2%80%93Howard_correspondence" alt="">カリー＝ハワード同型対応</a></li><li>「型↔命題」「プログラム↔証明」</li></ul></li></ul><p><img class="centered" src="pfi-seminar-2012-07-19_files/curry.png" alt=""></p></article><article><h3>なぜコードの正しさを証明しないのか？</h3><ul><li><p>定理証明の付いたコードを書くのは大変</p><ul><li><p>そもそもむずい</p><ul><li>普通に書くのはとても難しいので、tacticを用いて、 ゴールを分割し、穴埋めしながら書く</li></ul></li><li><p>コードがでかくなる</p><ul><li>証明なしのコードの10倍以上になるとか</li><li><a href="http://compcert.inria.fr/" alt="">COMPCERT</a> (Coqで証明されたCコンパイラ作るプロジェクト)</li></ul></li></ul></li></ul><p><small>（こんなことを書きつつ、私はあまり詳しくないです…すみません）</small></p></article><article><h3>コードの品質のために、我々は何をするべきか？</h3><ul><li><p>コードの正しさを保証することと、そのコストはトレードオフ</p></li><li><p>何をやって何をやらざるかは単に開発コストの問題</p><ul><li>これは情報学の問題でも数学の問題でもない</li></ul></li><li><p>スイートスポットを攻めるべき</p><ul><li>小さいコストで大きなリターンを得られるものから採用する</li></ul></li></ul></article><article><h3>In my opinion...</h3><ul><li><p>ユニットテスト</p><ul><li>やらないよりはやった方がいい</li></ul></li><li><p>静的型付け</p><ul><li>効果大</li><li>テストは型の代用ではない</li></ul></li><li><p>証明</p><ul><li>無理 (´&gt;_&gt;`)</li></ul></li></ul></article><article><h3>テストに「ちょい足し」</h3><ul><li><p>Generative Test</p><ul><li>テストケースを乱数で自動生成</li><li>普通のユニットテストを書くコストと大差がない</li><li>コストをはるかに上回る恩恵！</li></ul></li></ul><p>ぜひ Generative Test をやりましょう！</p></article><article><h3>だけど…</h3><ul><li><p>利用できる言語が限られる</p><ul><li><a href="http://hackage.haskell.org/package/QuickCheck" alt="">QuickCheck</a> が有名<ul><li>Haskell, Erlang</li><li>実際よく使われてる</li></ul></li><li>他の言語にも類似の実装が割りとあるが、完成度はまちまち<ul><li><a href="http://software.legiasoft.com/quickcheck/" alt="">C++実装</a> もあるが…</li><li>バージョン0.02 ... イマイチ感メンテナンスされてない感 ...</li></ul></li></ul></li></ul></article><article><h3>そういう事なら</h3><pre class="prettyprint"><span class="pun">　 　　　　 |</span><span class="pln">
　 　</span><span class="pun">＼　　</span><span class="pln">__</span><span class="pun">　　／</span><span class="pln">
　 　</span><span class="pun">＿　（ｍ）　＿ﾋﾟｺｰﾝ</span><span class="pln">
　 　　　　</span><span class="pun">|ミ|</span><span class="pln">
　 　 </span><span class="pun">／</span><span class="pln"> 　</span><span class="pun">｀´　 ＼</span><span class="pln">
　　　　　</span><span class="pun">(´･</span><span class="pln">_</span><span class="pun">･</span><span class="str">`) HaskellのQuickCheckでC++コードを
　　　　　ノヽノヽ テストすればいいじゃまいか！？
　　　　　　　くく</span></pre>

</article><article><h2>QuickCheck</h2></article><article><h3>QuickCheckについて</h3><ul><li><p><a href="http://www.cse.chalmers.se/%7Erjmh/QuickCheck/" alt=""></a><a href="http://www.cse.chalmers.se/%7Erjmh/QuickCheck/">http://www.cse.chalmers.se/~rjmh/QuickCheck/</a></p><ul><li>ICFP 2000 初出（？）</li><li>ICFP 2010、「最も世の中に影響を与えた10年前の論文」<ul><li>（これが最も影響あったということに、関数プログラミングの影響力の小ささが窺い知れる…）</li></ul></li><li>強力な型システムとあわせて、Haskellコードの品質向上に 実際大きく貢献している</li></ul></li></ul></article><article><h3>Quick start of QuickCheck</h3><ol><li><p><a href="http://hackage.haskell.org/platform/" alt="">Haskell Platform</a> をインストール</p></li><li><p>テストを含む cabal プロジェクトを作る</p></li><li><p>テストを書く</p></li><li><p>テストを実行</p></li><li><p>繰り返し</p></li></ol></article><article><h3>Haskell Platform インストール</h3><p>ダウンロードして、マウスをホチポチすれば入る（Linux以外） <img class="centered" src="pfi-seminar-2012-07-19_files/hp.png" alt=""></p></article><article><h3>cabal プロジェクトを作る</h3><p><code>&gt; cabal init</code> とタイプして、適当に質問に答える</p><pre class="prettyprint"><code class="sourceCode bash"><span class="pln">PS C</span><span class="pun">:</span><span class="pln">\Users\tanakh\Dropbox\project\tmp\qc</span><span class="pun">-</span><span class="pln">test</span><span class="kw"><span class="pun">&gt;</span></span><span class="pln"> cabal init
</span><span class="typ">Package</span><span class="pln"> name</span><span class="pun">?</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">default</span><span class="pun">:</span><span class="pln"> qc</span><span class="pun">-</span><span class="pln">test</span><span class="pun">]</span><span class="pln">
</span><span class="typ">Package</span><span class="pln"> version</span><span class="pun">?</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">default</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0.1</span><span class="pun">.</span><span class="lit">0.0</span><span class="pun">]</span><span class="pln">
</span><span class="typ">Please</span><span class="pln"> choose a license</span><span class="pun">:</span><span class="pln">
 </span><span class="pun">*</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="kw"><span class="pun">(</span></span><span class="pln">none</span><span class="kw"><span class="pun">)</span></span><span class="pln">
   </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> GPL</span><span class="pun">-</span><span class="lit">2</span><span class="pln">
   </span><span class="lit">3</span><span class="pun">)</span><span class="pln"> GPL</span><span class="pun">-</span><span class="lit">3</span><span class="pln">
</span><span class="pun">...</span><span class="pln">
</span><span class="typ">What</span><span class="pln"> does the </span><span class="kwd">package</span><span class="pln"> build</span><span class="pun">:</span><span class="pln">
   </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Library</span><span class="pln">
   </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Executable</span><span class="pln">
</span><span class="typ">Your</span><span class="pln"> choice</span><span class="pun">?</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="typ">Include</span><span class="pln"> documentation on what each field means </span><span class="kw"><span class="pun">(</span></span><span class="pln">y</span><span class="pun">/</span><span class="pln">n</span><span class="kw"><span class="pun">)</span></span><span class="pun">?</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">default</span><span class="pun">:</span><span class="pln"> n</span><span class="pun">]</span><span class="pln">
</span><span class="typ">Guessing</span><span class="pln"> dependencies</span><span class="pun">...</span><span class="pln">
</span><span class="pun">...</span><span class="pln">
</span><span class="typ">Generating</span><span class="pln"> qc</span><span class="pun">-</span><span class="pln">test</span><span class="pun">.</span><span class="pln">cabal</span><span class="pun">...</span></code></pre></article><article><h3>プロジェクトにテストを追加</h3><p><code>&lt;プロジェクト名&gt;.cabal</code> というファイルが生成されたはずなので、それを編集</p><pre class="prettyprint"><code class="sourceCode haskell"><span class="pln">name</span><span class="fu"><span class="pun">:</span></span><span class="pln">                qc</span><span class="fu"><span class="pun">-</span></span><span class="pln">test
version</span><span class="fu"><span class="pun">:</span></span><span class="pln">             </span><span class="fl"><span class="lit">0.1</span></span><span class="fu"><span class="pun">.</span></span><span class="fl"><span class="lit">0.0</span></span><span class="pln">
</span><span class="co"><span class="pun">--</span><span class="pln"> synopsis</span><span class="pun">:</span><span class="pln">            </span></span><span class="pln">
</span><span class="co"><span class="pun">--</span><span class="pln"> description</span><span class="pun">:</span><span class="pln">         </span></span><span class="pln">
license</span><span class="fu"><span class="pun">:</span></span><span class="pln">             </span><span class="dt"><span class="pln">BSD3</span></span><span class="pln">
</span><span class="pun">（略…）</span><span class="pln">
executable qc</span><span class="fu"><span class="pun">-</span></span><span class="pln">test
  main</span><span class="fu"><span class="pun">-</span></span><span class="kwd">is</span><span class="fu"><span class="pun">:</span></span><span class="pln">             main</span><span class="fu"><span class="pun">.</span></span><span class="pln">hs
  build</span><span class="fu"><span class="pun">-</span></span><span class="pln">depends</span><span class="fu"><span class="pun">:</span></span><span class="pln">       </span><span class="kwd">base</span><span class="pln"> </span><span class="fu"><span class="pun">==</span></span><span class="fl"><span class="lit">4.5</span></span><span class="fu"><span class="pun">.*</span></span><span class="pln">
</span><span class="co"><span class="pun">--</span><span class="pln"> </span><span class="pun">↓これを追加</span></span><span class="pln">
test</span><span class="fu"><span class="pun">-</span></span><span class="pln">suite hoge</span><span class="fu"><span class="pun">-</span></span><span class="pln">test
  </span><span class="kw"><span class="pln">type</span></span><span class="fu"><span class="pun">:</span></span><span class="pln">                exitcode</span><span class="fu"><span class="pun">-</span></span><span class="pln">stdio</span><span class="dv"><span class="pun">-</span><span class="lit">1</span></span><span class="fu"><span class="lit">.</span></span><span class="dv"><span class="lit">0</span></span><span class="pln">
  main</span><span class="fu"><span class="pun">-</span></span><span class="kwd">is</span><span class="fu"><span class="pun">:</span></span><span class="pln">             test</span><span class="fu"><span class="pun">.</span></span><span class="pln">hs
  build</span><span class="fu"><span class="pun">-</span></span><span class="pln">depends</span><span class="fu"><span class="pun">:</span></span><span class="pln">       </span><span class="kwd">base</span><span class="pln">  </span><span class="fu"><span class="pun">==</span></span><span class="fl"><span class="lit">4.5</span></span><span class="fu"><span class="pun">.*</span></span><span class="pln">
                     </span><span class="pun">,</span><span class="pln"> hspec </span><span class="fu"><span class="pun">&gt;=</span></span><span class="fl"><span class="lit">1.3</span></span></code></pre></article><article><h3>なんかプログラム書く</h3><ul><li>今回はリストの足し算をする関数を書いてみます</li></ul><pre class="prettyprint"><code class="sourceCode haskell"><span class="ot"><span class="pln">mySum </span><span class="pun">::</span></span><span class="pln"> </span><span class="pun">[</span><span class="dt"><span class="typ">Int</span></span><span class="pun">]</span><span class="pln"> </span><span class="ot"><span class="pun">-&gt;</span></span><span class="pln"> </span><span class="dt"><span class="typ">Int</span></span><span class="pln">
mySum </span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="fu"><span class="pun">=</span></span><span class="pln"> x
mySum </span><span class="pun">(</span><span class="pln">x</span><span class="fu"><span class="pun">:</span></span><span class="pln">xs</span><span class="pun">)</span><span class="pln"> </span><span class="fu"><span class="pun">=</span></span><span class="pln"> x </span><span class="fu"><span class="pun">+</span></span><span class="pln"> mySum xs</span></code></pre></article><article><h3>テストを書く</h3><ul><li><p><code>test.hs</code> に普通のユニットテストを書きます</p><ul><li><a href="http://hspec.github.com/" alt="">hspec</a>という<a href="http://rspec.info/" alt="">RSpec</a>インスパイアなテストフレームワークと</li><li><a href="http://hackage.haskell.org/package/HUnit" alt="">HUnit</a> という単体テストライブラリを使用</li></ul></li></ul><pre class="prettyprint"><code class="sourceCode haskell"><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Test</span><span class="pun">.</span><span class="typ">Hspec</span></span><span class="pln">

</span><span class="ot"><span class="pln">main </span><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="pln">IO</span></span><span class="pln"> </span><span class="pun">()</span><span class="pln">
main </span><span class="fu"><span class="pun">=</span></span><span class="pln"> hspec </span><span class="fu"><span class="pln">$</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln">
  describe </span><span class="st"><span class="str">"sum function"</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln">
    it </span><span class="st"><span class="str">"is correct"</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln">
      mySum </span><span class="pun">[</span><span class="dv"><span class="lit">1</span></span><span class="pun">,</span><span class="pln"> </span><span class="dv"><span class="lit">2</span></span><span class="pun">,</span><span class="pln"> </span><span class="dv"><span class="lit">3</span></span><span class="pun">]</span><span class="pln"> </span><span class="ot"><span class="str">`shouldBe`</span></span><span class="pln"> </span><span class="dv"><span class="lit">6</span></span><span class="pln">
      mySum </span><span class="pun">[</span><span class="dv"><span class="lit">1</span></span><span class="pln"> </span><span class="fu"><span class="pun">..</span></span><span class="pln"> </span><span class="dv"><span class="lit">10</span></span><span class="pun">]</span><span class="pln"> </span><span class="ot"><span class="str">`shouldBe`</span></span><span class="pln"> </span><span class="dv"><span class="lit">55</span></span></code></pre><p>思いつくままにテストケースを書きます</p></article><article><h3>テストを実行</h3><pre class="prettyprint"><code class="sourceCode bash"><span class="kw"><span class="pun">&gt;</span></span><span class="pln"> cabal build
</span><span class="typ">Building</span><span class="pln"> qc</span><span class="pun">-</span><span class="pln">test</span><span class="pun">-</span><span class="lit">0.1</span><span class="pun">.</span><span class="lit">0.0</span><span class="pun">...</span><span class="pln">
</span><span class="typ">Preprocessing</span><span class="pln"> executable </span><span class="st"><span class="str">'qc-test'</span></span><span class="pln"> </span><span class="kw"><span class="kwd">for</span></span><span class="pln"> qc</span><span class="pun">-</span><span class="pln">test</span><span class="pun">-</span><span class="lit">0.1</span><span class="pun">.</span><span class="lit">0.0</span><span class="pun">...</span><span class="pln">
</span><span class="pun">[</span><span class="lit">1</span><span class="pln"> of </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="typ">Compiling</span><span class="pln"> </span><span class="typ">Main</span><span class="pln">             </span><span class="kw"><span class="pun">(</span></span><span class="pln"> main</span><span class="pun">.</span><span class="pln">hs</span><span class="pun">,</span><span class="pln"> dist\build\qc</span><span class="pun">-</span><span class="pln">test\qc</span><span class="pun">-</span><span class="pln">test</span><span class="pun">-</span><span class="pln">tmp\Main</span><span class="pun">.</span><span class="pln">o </span><span class="kw"><span class="pun">)</span></span><span class="pln">
</span><span class="typ">Linking</span><span class="pln"> dist\build\qc</span><span class="pun">-</span><span class="pln">test\qc</span><span class="pun">-</span><span class="pln">test</span><span class="pun">.</span><span class="pln">exe </span><span class="pun">...</span><span class="pln">
</span><span class="typ">Preprocessing</span><span class="pln"> </span><span class="kw"><span class="pln">test</span></span><span class="pln"> suite </span><span class="st"><span class="str">'hoge-test'</span></span><span class="pln"> </span><span class="kw"><span class="kwd">for</span></span><span class="pln"> qc</span><span class="pun">-</span><span class="pln">test</span><span class="pun">-</span><span class="lit">0.1</span><span class="pun">.</span><span class="lit">0.0</span><span class="pun">...</span><span class="pln">
</span><span class="pun">[</span><span class="lit">1</span><span class="pln"> of </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="typ">Compiling</span><span class="pln"> </span><span class="typ">Main</span><span class="pln">             </span><span class="kw"><span class="pun">(</span></span><span class="pln"> test</span><span class="pun">.</span><span class="pln">hs</span><span class="pun">,</span><span class="pln"> dist\build\hoge</span><span class="pun">-</span><span class="pln">test\hoge</span><span class="pun">-</span><span class="pln">test</span><span class="pun">-</span><span class="pln">tmp\Main</span><span class="pun">.</span><span class="pln">o </span><span class="kw"><span class="pun">)</span></span><span class="pln">
</span><span class="typ">Linking</span><span class="pln"> dist\build\hoge</span><span class="pun">-</span><span class="pln">test\hoge</span><span class="pun">-</span><span class="pln">test</span><span class="pun">.</span><span class="pln">exe </span><span class="pun">...</span><span class="pln">
</span><span class="kw"><span class="pun">&gt;</span></span><span class="pln"> cabal </span><span class="kw"><span class="pln">test</span></span><span class="pln">
</span><span class="typ">Running</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="kw"><span class="pln">test</span></span><span class="pln"> suites</span><span class="pun">...</span><span class="pln">
</span><span class="typ">Test</span><span class="pln"> suite hoge</span><span class="pun">-</span><span class="pln">test</span><span class="pun">:</span><span class="pln"> RUNNING</span><span class="pun">...</span><span class="pln">
</span><span class="typ">Test</span><span class="pln"> suite hoge</span><span class="pun">-</span><span class="pln">test</span><span class="pun">:</span><span class="pln"> PASS
</span><span class="typ">Test</span><span class="pln"> suite logged to</span><span class="pun">:</span><span class="pln"> dist\</span><span class="kw"><span class="pln">test</span></span><span class="pln">\qc</span><span class="pun">-</span><span class="pln">test</span><span class="pun">-</span><span class="lit">0.1</span><span class="pun">.</span><span class="lit">0.0</span><span class="pun">-</span><span class="pln">hoge</span><span class="pun">-</span><span class="pln">test</span><span class="pun">.</span><span class="pln">log
</span><span class="lit">1</span><span class="pln"> of </span><span class="lit">1</span><span class="pln"> </span><span class="kw"><span class="pln">test</span></span><span class="pln"> suites </span><span class="kw"><span class="pun">(</span></span><span class="lit">1</span><span class="pln"> of </span><span class="lit">1</span><span class="pln"> </span><span class="kw"><span class="pln">test</span></span><span class="pln"> cases</span><span class="kw"><span class="pun">)</span></span><span class="pln"> passed</span><span class="pun">.</span></code></pre><p>パスしたようですね！</p></article><article><h3>QuickCheck のテストを書く</h3><ul><li><p>QuickCheckのテストケースは関数（プロパティという）</p><ul><li><strong>「何か」</strong> （ここでは <code>Int</code> のリスト） を受け取り、<code>Bool</code> を返す関数</li><li>QuickCheckが、関数の引数（テストデータ）を適当にたくさん生成する</li><li>すべてのテストデータについて <code>True</code> が帰ればパス</li></ul></li></ul><pre class="prettyprint"><code class="sourceCode haskell"><span class="ot"><span class="pln">prop_mySum </span><span class="pun">::</span></span><span class="pln"> </span><span class="pun">[</span><span class="dt"><span class="typ">Int</span></span><span class="pun">]</span><span class="pln"> </span><span class="ot"><span class="pun">-&gt;</span></span><span class="pln"> </span><span class="dt"><span class="typ">Bool</span></span><span class="pln">
prop_mySum xs </span><span class="fu"><span class="pun">=</span></span><span class="pln">
  mySum xs </span><span class="fu"><span class="pun">==</span></span><span class="pln"> </span><span class="fu"><span class="pln">sum</span></span><span class="pln"> xs </span><span class="co"><span class="pun">--</span><span class="pln"> sum </span><span class="pun">は標準のリストの総和を求める関数</span></span></code></pre><p>簡単でしょう？</p></article><article><h3>テストフレームワークに組み込み</h3><ul><li>prop 関数に記述とプロパティを渡す</li></ul><pre class="prettyprint"><code class="sourceCode haskell"><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Test</span><span class="pun">.</span><span class="typ">Hspec</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Test</span><span class="pun">.</span><span class="typ">Hspec</span><span class="pun">.</span><span class="typ">HUnit</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Test</span><span class="pun">.</span><span class="typ">Hspec</span><span class="pun">.</span><span class="typ">QuickCheck</span></span><span class="pln"> </span><span class="co"><span class="pun">--</span><span class="pln"> </span><span class="pun">これを追加</span></span><span class="pln">
</span><span class="co"><span class="pun">--</span><span class="pln"> </span><span class="pun">(略)</span></span><span class="pln">

</span><span class="ot"><span class="pln">main </span><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="pln">IO</span></span><span class="pln"> </span><span class="pun">()</span><span class="pln">
main </span><span class="fu"><span class="pun">=</span></span><span class="pln"> hspec </span><span class="fu"><span class="pln">$</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln">
  describe </span><span class="st"><span class="str">"sum function"</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln">
    it </span><span class="st"><span class="str">"is correct"</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln">
      mySum </span><span class="pun">[</span><span class="dv"><span class="lit">1</span></span><span class="pun">,</span><span class="pln"> </span><span class="dv"><span class="lit">2</span></span><span class="pun">,</span><span class="pln"> </span><span class="dv"><span class="lit">3</span></span><span class="pun">]</span><span class="pln"> </span><span class="ot"><span class="str">`shouldBe`</span></span><span class="pln"> </span><span class="dv"><span class="lit">6</span></span><span class="pln">
      mySum </span><span class="pun">[</span><span class="dv"><span class="lit">1</span></span><span class="pln"> </span><span class="fu"><span class="pun">..</span></span><span class="pln"> </span><span class="dv"><span class="lit">10</span></span><span class="pun">]</span><span class="pln"> </span><span class="ot"><span class="str">`shouldBe`</span></span><span class="pln"> </span><span class="dv"><span class="lit">55</span></span><span class="pln">

    prop </span><span class="st"><span class="str">"is equivalent to sum"</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="pln"> </span><span class="co"><span class="pun">--</span><span class="pln"> </span><span class="pun">これを</span></span><span class="pln">
      prop_mySum                  </span><span class="co"><span class="pun">--</span><span class="pln"> </span><span class="pun">追加</span></span></code></pre></article><article><h3>別な書き方</h3><ul><li>直に書いても良い</li></ul><pre class="prettyprint"><code class="sourceCode haskell"><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Test</span><span class="pun">.</span><span class="typ">Hspec</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Test</span><span class="pun">.</span><span class="typ">Hspec</span><span class="pun">.</span><span class="typ">HUnit</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Test</span><span class="pun">.</span><span class="typ">Hspec</span><span class="pun">.</span><span class="typ">QuickCheck</span></span><span class="pln">
</span><span class="co"><span class="pun">--</span><span class="pln"> </span><span class="pun">(略)</span></span><span class="pln">

</span><span class="ot"><span class="pln">main </span><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="pln">IO</span></span><span class="pln"> </span><span class="pun">()</span><span class="pln">
main </span><span class="fu"><span class="pun">=</span></span><span class="pln"> hspec </span><span class="fu"><span class="pln">$</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln">
  describe </span><span class="st"><span class="str">"sum function"</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln">
    it </span><span class="st"><span class="str">"is correct"</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln">
      mySum </span><span class="pun">[</span><span class="dv"><span class="lit">1</span></span><span class="pun">,</span><span class="pln"> </span><span class="dv"><span class="lit">2</span></span><span class="pun">,</span><span class="pln"> </span><span class="dv"><span class="lit">3</span></span><span class="pun">]</span><span class="pln"> </span><span class="ot"><span class="str">`shouldBe`</span></span><span class="pln"> </span><span class="dv"><span class="lit">6</span></span><span class="pln">
      mySum </span><span class="pun">[</span><span class="dv"><span class="lit">1</span></span><span class="pln"> </span><span class="fu"><span class="pun">..</span></span><span class="pln"> </span><span class="dv"><span class="lit">10</span></span><span class="pun">]</span><span class="pln"> </span><span class="ot"><span class="str">`shouldBe`</span></span><span class="pln"> </span><span class="dv"><span class="lit">55</span></span><span class="pln">

    prop </span><span class="st"><span class="str">"is equivalent to sum"</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="pln"> \xs </span><span class="ot"><span class="pun">-&gt;</span></span><span class="pln">
      mySym xs </span><span class="fu"><span class="pun">==</span></span><span class="pln"> </span><span class="fu"><span class="pln">sum</span></span><span class="pln"> xs</span></code></pre></article><article><h3>QuickCheck テストの実行</h3><ul><li>テストフレームワークが面倒を見てくれるので、同じように実行するだけ！</li></ul><pre class="prettyprint"><code class="sourceCode bash"><span class="kw"><span class="pun">&gt;</span></span><span class="pln"> cabal build </span><span class="kw"><span class="pun">&amp;&amp;</span></span><span class="pln"> cabal </span><span class="kw"><span class="pln">test</span></span><span class="pln">
</span><span class="typ">Running</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="kw"><span class="pln">test</span></span><span class="pln"> suites</span><span class="pun">...</span><span class="pln">
</span><span class="typ">Test</span><span class="pln"> suite hoge</span><span class="pun">-</span><span class="pln">test</span><span class="pun">:</span><span class="pln"> RUNNING</span><span class="pun">...</span><span class="pln">

</span><span class="kw"><span class="pln">sum</span></span><span class="pln"> </span><span class="kw"><span class="kwd">function</span></span><span class="pln">
 </span><span class="pun">-</span><span class="pln"> </span><span class="kwd">is</span><span class="pln"> correct
 </span><span class="pun">-</span><span class="pln"> </span><span class="kwd">is</span><span class="pln"> equivalent to </span><span class="kw"><span class="pln">sum</span></span><span class="pln"> FAILED </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="kw"><span class="pln">sum</span></span><span class="pln"> </span><span class="kw"><span class="kwd">function</span></span><span class="fu"><span class="pln"> </span><span class="kwd">is</span></span><span class="pln"> equivalent to </span><span class="kw"><span class="pln">sum</span></span><span class="pln"> FAILED
</span><span class="pun">***</span><span class="pln"> </span><span class="typ">Failed</span><span class="pun">!</span><span class="pln"> </span><span class="typ">Exception</span><span class="pun">:</span><span class="pln"> </span><span class="st"><span class="str">'test.hs:(6,1)-(7,27): Non-exhaustive patterns in function mySum'</span></span><span class="pln"> </span><span class="kw"><span class="pun">(</span></span><span class="pln">after </span><span class="lit">1</span><span class="pln"> </span><span class="kw"><span class="pln">test</span><span class="pun">):</span></span><span class="pln">
</span><span class="pun">[]</span><span class="pln">
</span><span class="pun">...</span><span class="pln">
</span><span class="lit">0</span><span class="pln"> of </span><span class="lit">1</span><span class="pln"> </span><span class="kw"><span class="pln">test</span></span><span class="pln"> suites </span><span class="kw"><span class="pun">(</span></span><span class="lit">0</span><span class="pln"> of </span><span class="lit">1</span><span class="pln"> </span><span class="kw"><span class="pln">test</span></span><span class="pln"> cases</span><span class="kw"><span class="pun">)</span></span><span class="pln"> passed</span><span class="pun">.</span></code></pre><p>おや(棒)、テストがコケたみたいですね</p></article><article><h3>テストの結果</h3><ul><li>どのテストが、どの入力で、どういう理由でこけたかが出力</li></ul><pre class="prettyprint"><code class="sourceCode haskell"><span class="pln">   </span><span class="fu"><span class="pun">-</span></span><span class="pln"> </span><span class="kwd">is</span><span class="pln"> equivalent to </span><span class="fu"><span class="pln">sum</span></span><span class="pln"> </span><span class="dt"><span class="pln">FAILED</span></span><span class="pln"> </span><span class="pun">[</span><span class="dv"><span class="lit">1</span></span><span class="pun">]</span></code></pre><pre class="prettyprint"><code class="sourceCode haskell"><span class="fu"><span class="pun">&gt;</span></span><span class="pln"> </span><span class="dv"><span class="lit">1</span></span><span class="pun">)</span><span class="pln"> </span><span class="fu"><span class="pln">sum</span></span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="kwd">is</span><span class="pln"> equivalent to </span><span class="fu"><span class="pln">sum</span></span><span class="pln"> </span><span class="dt"><span class="pln">FAILED</span></span><span class="pln">
</span><span class="fu"><span class="pun">&gt;</span></span><span class="pln"> </span><span class="fu"><span class="pun">***</span></span><span class="pln"> </span><span class="dt"><span class="typ">Failed</span></span><span class="fu"><span class="pun">!</span></span><span class="pln"> </span><span class="dt"><span class="typ">Exception</span></span><span class="fu"><span class="pun">:</span></span><span class="pln"> </span><span class="ch"><span class="str">'test.hs:(6,1)-(7,27): Non-exhaustive patterns in function mySum'</span></span><span class="pln"> </span><span class="pun">(</span><span class="pln">after </span><span class="dv"><span class="lit">1</span></span><span class="pln"> test</span><span class="pun">)</span><span class="fu"><span class="pun">:</span></span><span class="pln">
</span><span class="fu"><span class="pun">&gt;</span></span><span class="pln"> </span><span class="pun">[]</span></code></pre><p>どうやら、空のリストの時にエラーになっているようです</p><pre class="prettyprint"><code class="sourceCode haskell"><span class="ot"><span class="pln">mySum </span><span class="pun">::</span></span><span class="pln"> </span><span class="pun">[</span><span class="dt"><span class="typ">Int</span></span><span class="pun">]</span><span class="pln"> </span><span class="ot"><span class="pun">-&gt;</span></span><span class="pln"> </span><span class="dt"><span class="typ">Int</span></span><span class="pln">
mySum </span><span class="pun">[</span><span class="pln">x</span><span class="pun">]</span><span class="pln"> </span><span class="fu"><span class="pun">=</span></span><span class="pln"> x    </span><span class="pun">←</span><span class="pln">   </span><span class="pun">あっ(´･</span><span class="pln">_</span><span class="pun">･</span><span class="ot"><span class="str">`)</span></span><span class="str">
</span><span class="ot"><span class="str">mySum (x:xs) = x + mySum xs</span></span></code></pre></article><article><h3>修正＆再実行</h3><pre class="prettyprint"><code class="sourceCode haskell"><span class="pln">mySum </span><span class="pun">[]</span><span class="pln"> </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="dv"><span class="lit">0</span></span><span class="pln">
mySum </span><span class="pun">(</span><span class="pln">x</span><span class="fu"><span class="pun">:</span></span><span class="pln">xs</span><span class="pun">)</span><span class="pln"> </span><span class="fu"><span class="pun">=</span></span><span class="pln"> x </span><span class="fu"><span class="pun">+</span></span><span class="pln"> mySum xs</span></code></pre><p>直して、再実行</p><pre class="prettyprint"><code class="sourceCode bash"><span class="kw"><span class="pun">&gt;</span></span><span class="pln"> cabal </span><span class="kw"><span class="pln">test</span></span><span class="pln">
</span><span class="typ">Running</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="kw"><span class="pln">test</span></span><span class="pln"> suites</span><span class="pun">...</span><span class="pln">
</span><span class="typ">Test</span><span class="pln"> suite hoge</span><span class="pun">-</span><span class="pln">test</span><span class="pun">:</span><span class="pln"> RUNNING</span><span class="pun">...</span><span class="pln">
</span><span class="typ">Test</span><span class="pln"> suite hoge</span><span class="pun">-</span><span class="pln">test</span><span class="pun">:</span><span class="pln"> PASS
</span><span class="typ">Test</span><span class="pln"> suite logged to</span><span class="pun">:</span><span class="pln"> dist\</span><span class="kw"><span class="pln">test</span></span><span class="pln">\qc</span><span class="pun">-</span><span class="pln">test</span><span class="pun">-</span><span class="lit">0.1</span><span class="pun">.</span><span class="lit">0.0</span><span class="pun">-</span><span class="pln">hoge</span><span class="pun">-</span><span class="pln">test</span><span class="pun">.</span><span class="pln">log
</span><span class="lit">1</span><span class="pln"> of </span><span class="lit">1</span><span class="pln"> </span><span class="kw"><span class="pln">test</span></span><span class="pln"> suites </span><span class="kw"><span class="pun">(</span></span><span class="lit">1</span><span class="pln"> of </span><span class="lit">1</span><span class="pln"> </span><span class="kw"><span class="pln">test</span></span><span class="pln"> cases</span><span class="kw"><span class="pun">)</span></span><span class="pln"> passed</span><span class="pun">.</span></code></pre><p>ふう、事なきを得ました。</p></article><article><h3>C++のコードをテストする</h3><ul><li><p>C++のコードをQuickCheckする</p></li><li><p>HaskellからC++のコードを呼び出せば良い</p><ul><li>HaskellからC++（C）のコードを呼び出すのはとても簡単</li><li>FFI (Foreign Function Interface) を用いる</li></ul></li></ul></article><article><h3>HaskellからC++コードを呼び出す</h3><ul><li>まず、C++のコードを書きます</li></ul><pre class="prettyprint"><code class="sourceCode cpp"><span class="dt"><span class="kwd">int</span></span><span class="pln"> add</span><span class="pun">(</span><span class="dt"><span class="kwd">int</span></span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="dt"><span class="kwd">int</span></span><span class="pln"> y</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kw"><span class="kwd">return</span></span><span class="pln"> x </span><span class="pun">*</span><span class="pln"> y</span><span class="pun">;</span><span class="pln"> </span><span class="co"><span class="com">// わざと間違えてます！！</span></span><span class="pln">
</span><span class="pun">}</span></code></pre></article><article><h3>.cabal ファイルを編集</h3><pre class="prettyprint"><code class="sourceCode haskell"><span class="pln">test</span><span class="fu"><span class="pun">-</span></span><span class="pln">suite hoge</span><span class="fu"><span class="pun">-</span></span><span class="pln">test
  </span><span class="kw"><span class="pln">type</span></span><span class="fu"><span class="pun">:</span></span><span class="pln">                exitcode</span><span class="fu"><span class="pun">-</span></span><span class="pln">stdio</span><span class="dv"><span class="pun">-</span><span class="lit">1</span></span><span class="fu"><span class="lit">.</span></span><span class="dv"><span class="lit">0</span></span><span class="pln">
  main</span><span class="fu"><span class="pun">-</span></span><span class="kwd">is</span><span class="fu"><span class="pun">:</span></span><span class="pln">             test</span><span class="fu"><span class="pun">.</span></span><span class="pln">hs
  build</span><span class="fu"><span class="pun">-</span></span><span class="pln">depends</span><span class="fu"><span class="pun">:</span></span><span class="pln">       </span><span class="kwd">base</span><span class="pln"> </span><span class="fu"><span class="pun">==</span></span><span class="fl"><span class="lit">4.5</span></span><span class="fu"><span class="pun">.*</span></span><span class="pln">
                     </span><span class="pun">,</span><span class="pln"> hspec
                     </span><span class="pun">,</span><span class="pln"> </span><span class="dt"><span class="typ">QuickCheck</span></span><span class="pln">
  </span><span class="co"><span class="pun">--</span><span class="pln"> </span><span class="pun">↓</span><span class="pln"> C</span><span class="pun">++ファイルを</span><span class="pln"> c</span><span class="pun">-</span><span class="pln">sources </span><span class="pun">に列挙して外部ライブラリに</span><span class="pln">stdc</span><span class="pun">++を追加</span></span><span class="pln">
  c</span><span class="fu"><span class="pun">-</span></span><span class="pln">sources</span><span class="fu"><span class="pun">:</span></span><span class="pln">           hoge</span><span class="fu"><span class="pun">.</span></span><span class="pln">cpp
  extra</span><span class="fu"><span class="pun">-</span></span><span class="pln">libraries</span><span class="fu"><span class="pun">:</span></span><span class="pln">     stdc</span><span class="fu"><span class="pun">++</span></span></code></pre></article><article><h3>C++を呼び出すコードを書く</h3><p><code>foreign import ccall</code> で <code>cdecl</code> 呼び出し規約の関数を呼び出せる</p><pre class="prettyprint"><code class="sourceCode haskell"><span class="ot"><span class="pun">{-</span><span class="com"># LANGUAGE ForeignFunctionInterface #-}</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Test</span><span class="pun">.</span><span class="typ">Hspec</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Test</span><span class="pun">.</span><span class="typ">Hspec</span><span class="pun">.</span><span class="typ">HUnit</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Test</span><span class="pun">.</span><span class="typ">Hspec</span><span class="pun">.</span><span class="typ">QuickCheck</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Test</span><span class="pun">.</span><span class="typ">QuickCheck</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Test</span><span class="pun">.</span><span class="typ">QuickCheck</span><span class="pun">.</span><span class="typ">Property</span></span><span class="pln">

</span><span class="ot"><span class="pln">main </span><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="pln">IO</span></span><span class="pln"> </span><span class="pun">()</span><span class="pln">
main </span><span class="fu"><span class="pun">=</span></span><span class="pln"> hspec </span><span class="fu"><span class="pln">$</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln">
  describe </span><span class="st"><span class="str">"add function"</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln">
    prop </span><span class="st"><span class="str">"it corrects"</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="pln"> \x y </span><span class="ot"><span class="pun">-&gt;</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln">
      morallyDubiousIOProperty </span><span class="fu"><span class="pln">$</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln"> </span><span class="co"><span class="pun">--</span><span class="pln"> </span><span class="pun">テスト中で</span><span class="pln">IO</span><span class="pun">をやるための関数</span></span><span class="pln">
        z </span><span class="ot"><span class="pun">&lt;-</span></span><span class="pln"> add x y
        </span><span class="fu"><span class="kwd">return</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="pln"> z </span><span class="fu"><span class="pun">==</span></span><span class="pln"> x </span><span class="fu"><span class="pun">+</span></span><span class="pln"> y

foreign </span><span class="kw"><span class="kwd">import</span></span><span class="pln"> ccall</span><span class="ot"><span class="pln"> add </span><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">Int</span></span><span class="pln"> </span><span class="ot"><span class="pun">-&gt;</span></span><span class="pln"> </span><span class="dt"><span class="typ">Int</span></span><span class="pln"> </span><span class="ot"><span class="pun">-&gt;</span></span><span class="pln"> </span><span class="dt"><span class="pln">IO</span></span><span class="pln"> </span><span class="dt"><span class="typ">Int</span></span></code></pre></article><article><h3>テスト実行</h3><pre class="prettyprint"><code class="sourceCode haskell"><span class="fu"><span class="pun">&gt;</span></span><span class="pln"> cabal test
</span><span class="dt"><span class="typ">Running</span></span><span class="pln"> </span><span class="dv"><span class="lit">1</span></span><span class="pln"> test suites</span><span class="fu"><span class="pun">...</span></span><span class="pln">
</span><span class="dt"><span class="typ">Test</span></span><span class="pln"> suite hoge</span><span class="fu"><span class="pun">-</span></span><span class="pln">test</span><span class="fu"><span class="pun">:</span></span><span class="pln"> </span><span class="fu"><span class="pln">RUNNING</span><span class="pun">...</span></span><span class="pln">

add </span><span class="kwd">function</span><span class="pln">
 </span><span class="fu"><span class="pun">-</span></span><span class="pln"> it corrects </span><span class="dt"><span class="pln">FAILED</span></span><span class="pln"> </span><span class="pun">[</span><span class="dv"><span class="lit">1</span></span><span class="pun">]</span><span class="pln">

</span><span class="dv"><span class="lit">1</span></span><span class="pun">)</span><span class="pln"> add </span><span class="kwd">function</span><span class="pln"> it corrects </span><span class="dt"><span class="pln">FAILED</span></span><span class="pln">
</span><span class="fu"><span class="pun">***</span></span><span class="pln"> </span><span class="dt"><span class="typ">Failed</span></span><span class="fu"><span class="pun">!</span></span><span class="pln"> </span><span class="dt"><span class="typ">Falsifiable</span></span><span class="pln"> </span><span class="pun">(</span><span class="pln">after </span><span class="dv"><span class="lit">1</span></span><span class="pln"> test </span><span class="fu"><span class="kwd">and</span></span><span class="pln"> </span><span class="dv"><span class="lit">2</span></span><span class="pln"> shrinks</span><span class="pun">)</span><span class="fu"><span class="pun">:</span></span><span class="pln">
</span><span class="dv"><span class="lit">0</span></span><span class="pln">
</span><span class="dv"><span class="lit">1</span></span><span class="pln">


</span><span class="dt"><span class="typ">Finished</span></span><span class="pln"> </span><span class="kw"><span class="kwd">in</span></span><span class="pln"> </span><span class="fl"><span class="lit">0.0120</span></span><span class="pln"> seconds</span><span class="pun">,</span><span class="pln"> used </span><span class="fl"><span class="lit">0.0156</span></span><span class="pln"> seconds </span><span class="kw"><span class="pln">of</span></span><span class="pln"> </span><span class="dt"><span class="pln">CPU</span></span><span class="pln"> time

</span><span class="dv"><span class="lit">1</span></span><span class="pln"> example</span><span class="pun">,</span><span class="pln"> </span><span class="dv"><span class="lit">1</span></span><span class="pln"> failure
</span><span class="dt"><span class="typ">Test</span></span><span class="pln"> suite hoge</span><span class="fu"><span class="pun">-</span></span><span class="pln">test</span><span class="fu"><span class="pun">:</span></span><span class="pln"> </span><span class="dt"><span class="pln">FAIL</span></span><span class="pln">
</span><span class="dt"><span class="typ">Test</span></span><span class="pln"> suite logged to</span><span class="fu"><span class="pun">:</span></span><span class="pln"> dist\test\qc</span><span class="fu"><span class="pun">-</span></span><span class="pln">test</span><span class="dv"><span class="pun">-</span><span class="lit">0</span></span><span class="fu"><span class="lit">.</span></span><span class="fl"><span class="lit">1</span><span class="pun">.</span><span class="lit">0</span></span><span class="fu"><span class="lit">.</span></span><span class="dv"><span class="lit">0</span></span><span class="fu"><span class="pun">-</span></span><span class="pln">hoge</span><span class="fu"><span class="pun">-</span></span><span class="pln">test</span><span class="fu"><span class="pun">.</span><span class="pln">log</span></span><span class="pln">
</span><span class="dv"><span class="lit">0</span></span><span class="pln"> </span><span class="kw"><span class="pln">of</span></span><span class="pln"> </span><span class="dv"><span class="lit">1</span></span><span class="pln"> test suites </span><span class="pun">(</span><span class="dv"><span class="lit">0</span></span><span class="pln"> </span><span class="kw"><span class="pln">of</span></span><span class="pln"> </span><span class="dv"><span class="lit">1</span></span><span class="pln"> test cases</span><span class="pun">)</span><span class="pln"> passed</span><span class="fu"><span class="pun">.</span></span></code></pre></article><article><h3>C++コードをQuickCheck</h3><pre class="prettyprint"><code class="sourceCode haskell"><span class="fu"><span class="com">#</span></span><span class="com">include</span><span class="pln"> </span><span class="fu"><span class="str">&lt;</span></span><span class="str">vector</span><span class="fu"><span class="str">&gt;</span></span><span class="pln">
</span><span class="kwd">using</span><span class="pln"> </span><span class="kwd">namespace</span><span class="pln"> std</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> vsum</span><span class="pun">(</span><span class="fu"><span class="kwd">const</span></span><span class="pln"> vector</span><span class="fu"><span class="str">&lt;</span></span><span class="str">int</span><span class="fu"><span class="str">&gt;</span></span><span class="pln"> </span><span class="fu"><span class="pun">&amp;</span></span><span class="pln">v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> ret </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="dv"><span class="lit">0</span></span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">size_t i </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="dv"><span class="lit">0</span></span><span class="pun">;</span><span class="pln"> i </span><span class="fu"><span class="pun">&lt;</span></span><span class="pln"> v</span><span class="fu"><span class="pun">.</span></span><span class="pln">size</span><span class="pun">();</span><span class="pln"> </span><span class="fu"><span class="pun">++</span></span><span class="pln">i</span><span class="pun">)</span><span class="pln">
    ret </span><span class="fu"><span class="pun">+=</span></span><span class="pln"> v</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span><span class="pln">
  </span><span class="fu"><span class="kwd">return</span></span><span class="pln"> ret</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre><p>これをテストしたいが、Haskellのデータ構造とのマーシャリングが面倒なので、 ラッパ関数を書く</p><pre class="prettyprint"><code class="sourceCode haskell"><span class="kwd">extern</span><span class="pln"> </span><span class="st"><span class="str">"C"</span></span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> c_vsum</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> </span><span class="fu"><span class="pun">*</span></span><span class="pln">p</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="fu"><span class="kwd">return</span></span><span class="pln"> vsum</span><span class="pun">(</span><span class="pln">vector</span><span class="fu"><span class="str">&lt;</span></span><span class="str">int</span><span class="fu"><span class="str">&gt;</span></span><span class="pun">(</span><span class="pln">p</span><span class="pun">,</span><span class="pln"> p</span><span class="fu"><span class="pun">+</span></span><span class="pln">n</span><span class="pun">));</span><span class="pln">
</span><span class="pun">}</span></code></pre></article><article><h3>テストコード</h3><pre class="prettyprint"><code class="sourceCode haskell"><span class="ot"><span class="pun">{-</span><span class="com"># LANGUAGE ForeignFunctionInterface #-}</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Test</span><span class="pun">.</span><span class="typ">Hspec</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Test</span><span class="pun">.</span><span class="typ">Hspec</span><span class="pun">.</span><span class="typ">HUnit</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Test</span><span class="pun">.</span><span class="typ">Hspec</span><span class="pun">.</span><span class="typ">QuickCheck</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Test</span><span class="pun">.</span><span class="typ">QuickCheck</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Test</span><span class="pun">.</span><span class="typ">QuickCheck</span><span class="pun">.</span><span class="typ">Property</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Foreign</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Foreign</span><span class="pun">.</span><span class="pln">C</span></span><span class="pln">

</span><span class="ot"><span class="pln">main </span><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="pln">IO</span></span><span class="pln"> </span><span class="pun">()</span><span class="pln">
main </span><span class="fu"><span class="pun">=</span></span><span class="pln"> hspec </span><span class="fu"><span class="pln">$</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln">
  describe </span><span class="st"><span class="str">"add function"</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln">
    prop </span><span class="st"><span class="str">"it corrects"</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="pln"> \xs </span><span class="ot"><span class="pun">-&gt;</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln">
      morallyDubiousIOProperty </span><span class="fu"><span class="pln">$</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln">
        withArrayLen </span><span class="pun">(</span><span class="fu"><span class="pln">map</span></span><span class="pln"> </span><span class="fu"><span class="pln">fromIntegral</span></span><span class="pln"> xs</span><span class="pun">)</span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="pln"> \len ptr </span><span class="ot"><span class="pun">-&gt;</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln">
          ret </span><span class="ot"><span class="pun">&lt;-</span></span><span class="pln"> c_vsum ptr </span><span class="pun">(</span><span class="fu"><span class="pln">fromIntegral</span></span><span class="pln"> len</span><span class="pun">)</span><span class="pln">
          </span><span class="fu"><span class="kwd">return</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="pln"> </span><span class="fu"><span class="pln">fromIntegral</span></span><span class="pln"> ret </span><span class="fu"><span class="pun">==</span></span><span class="pln"> </span><span class="pun">(</span><span class="fu"><span class="pln">sum</span></span><span class="ot"><span class="pln"> xs </span><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">Int</span></span><span class="pun">)</span><span class="pln">

foreign </span><span class="kw"><span class="kwd">import</span></span><span class="pln"> ccall</span><span class="ot"><span class="pln"> c_vsum </span><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">Ptr</span></span><span class="pln"> </span><span class="dt"><span class="typ">CInt</span></span><span class="pln"> </span><span class="ot"><span class="pun">-&gt;</span></span><span class="pln"> </span><span class="dt"><span class="typ">CInt</span></span><span class="pln"> </span><span class="ot"><span class="pun">-&gt;</span></span><span class="pln"> </span><span class="dt"><span class="pln">IO</span></span><span class="pln"> </span><span class="dt"><span class="typ">CInt</span></span></code></pre></article><article><h3>テスト実行</h3><pre class="prettyprint"><code class="sourceCode haskell"><span class="fu"><span class="pun">&gt;</span></span><span class="pln"> cabal test
</span><span class="dt"><span class="typ">Running</span></span><span class="pln"> </span><span class="dv"><span class="lit">1</span></span><span class="pln"> test suites</span><span class="fu"><span class="pun">...</span></span><span class="pln">
</span><span class="dt"><span class="typ">Test</span></span><span class="pln"> suite hoge</span><span class="fu"><span class="pun">-</span></span><span class="pln">test</span><span class="fu"><span class="pun">:</span></span><span class="pln"> </span><span class="fu"><span class="pln">RUNNING</span><span class="pun">...</span></span><span class="pln">
</span><span class="dt"><span class="typ">Test</span></span><span class="pln"> suite hoge</span><span class="fu"><span class="pun">-</span></span><span class="pln">test</span><span class="fu"><span class="pun">:</span></span><span class="pln"> </span><span class="dt"><span class="pln">FAIL</span></span><span class="pln">
</span><span class="dt"><span class="typ">Test</span></span><span class="pln"> suite logged to</span><span class="fu"><span class="pun">:</span></span><span class="pln"> dist\test\qc</span><span class="fu"><span class="pun">-</span></span><span class="pln">test</span><span class="dv"><span class="pun">-</span><span class="lit">0</span></span><span class="fu"><span class="lit">.</span></span><span class="fl"><span class="lit">1</span><span class="pun">.</span><span class="lit">0</span></span><span class="fu"><span class="lit">.</span></span><span class="dv"><span class="lit">0</span></span><span class="fu"><span class="pun">-</span></span><span class="pln">hoge</span><span class="fu"><span class="pun">-</span></span><span class="pln">test</span><span class="fu"><span class="pun">.</span><span class="pln">log</span></span><span class="pln">
</span><span class="dv"><span class="lit">0</span></span><span class="pln"> </span><span class="kw"><span class="pln">of</span></span><span class="pln"> </span><span class="dv"><span class="lit">1</span></span><span class="pln"> test suites </span><span class="pun">(</span><span class="dv"><span class="lit">0</span></span><span class="pln"> </span><span class="kw"><span class="pln">of</span></span><span class="pln"> </span><span class="dv"><span class="lit">1</span></span><span class="pln"> test cases</span><span class="pun">)</span><span class="pln"> passed</span><span class="fu"><span class="pun">.</span></span></code></pre><p>C++のテストがQuickCheckできました(´^_^`)!</p></article><article><h2>ベンチマーク</h2></article><article><h3><a href="http://bos.github.com/criterion/" alt="">Criterion</a></h3><ul><li><p>Haskellのベンチマークフレームワーク</p><ul><li>カッコいいレポートページが出る</li></ul></li></ul><iframe src="pfi-seminar-2012-07-19_files/a_002.htm"></iframe>
</article><article><h3>Criterionの特徴</h3><ul><li><p>時間計測のオーバーヘッドの計測と除去</p></li><li><p>多数回の繰り返しとブートストラップ法による統計データ計算</p></li><li><p>短い実行時間のプログラムを正確に計測できる</p></li><li><p>かっこいいレポートページが出る！</p></li></ul><p>C++でも使いたい！</p></article><article><h3>C++をCriterion</h3><ul><li>こいつにC++を食わせると…？</li></ul><p>とりあえず適当にソートプログラム書いてみた</p><pre class="prettyprint"><code class="sourceCode cpp"><span class="ot"><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;vector&gt;</span></span><span class="pln">
</span><span class="ot"><span class="com">#include</span><span class="pln"> </span><span class="str">&lt;algorithm&gt;</span></span><span class="pln">
</span><span class="kw"><span class="kwd">using</span></span><span class="pln"> </span><span class="kw"><span class="kwd">namespace</span></span><span class="pln"> std</span><span class="pun">;</span><span class="pln">

</span><span class="kw"><span class="kwd">extern</span></span><span class="pln"> </span><span class="st"><span class="str">"C"</span></span><span class="pln">
</span><span class="dt"><span class="kwd">void</span></span><span class="pln"> vsort</span><span class="pun">(</span><span class="dt"><span class="kwd">int</span></span><span class="pln"> </span><span class="pun">*</span><span class="pln">p</span><span class="pun">,</span><span class="pln"> </span><span class="dt"><span class="kwd">int</span></span><span class="pln"> n</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
  vector v</span><span class="pun">(</span><span class="pln">p</span><span class="pun">,</span><span class="pln"> p</span><span class="pun">+</span><span class="pln">n</span><span class="pun">);</span><span class="pln">
  sort</span><span class="pun">(</span><span class="pln">v</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">(),</span><span class="pln"> v</span><span class="pun">.</span><span class="kwd">end</span><span class="pun">());</span><span class="pln">
</span><span class="pun">}</span></code></pre></article><article><h3>ベンチマークを cabalファイルに追加</h3><pre class="prettyprint"><code class="sourceCode haskell"><span class="pln">benchmark hoge</span><span class="fu"><span class="pun">-</span></span><span class="pln">bench
  </span><span class="kw"><span class="pln">type</span></span><span class="fu"><span class="pun">:</span></span><span class="pln">                exitcode</span><span class="fu"><span class="pun">-</span></span><span class="pln">stdio</span><span class="dv"><span class="pun">-</span><span class="lit">1</span></span><span class="fu"><span class="lit">.</span></span><span class="dv"><span class="lit">0</span></span><span class="pln">
  main</span><span class="fu"><span class="pun">-</span></span><span class="kwd">is</span><span class="fu"><span class="pun">:</span></span><span class="pln">             bench</span><span class="fu"><span class="pun">.</span></span><span class="pln">hs
  build</span><span class="fu"><span class="pun">-</span></span><span class="pln">depends</span><span class="fu"><span class="pun">:</span></span><span class="pln">       </span><span class="kwd">base</span><span class="pln"> </span><span class="fu"><span class="pun">==</span></span><span class="fl"><span class="lit">4.5</span></span><span class="fu"><span class="pun">.*</span></span><span class="pln">
                     </span><span class="pun">,</span><span class="pln"> criterion
                     </span><span class="pun">,</span><span class="pln"> random
  c</span><span class="fu"><span class="pun">-</span></span><span class="pln">sources</span><span class="fu"><span class="pun">:</span></span><span class="pln">           hoge</span><span class="fu"><span class="pun">.</span></span><span class="pln">cpp
  extra</span><span class="fu"><span class="pun">-</span></span><span class="pln">libraries</span><span class="fu"><span class="pun">:</span></span><span class="pln">     stdc</span><span class="fu"><span class="pun">++</span></span></code></pre></article><article><h3>Criterion書く</h3><pre class="prettyprint"><code class="sourceCode haskell"><span class="ot"><span class="pun">{-</span><span class="com"># LANGUAGE ForeignFunctionInterface #-}</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Control</span><span class="pun">.</span><span class="typ">Monad</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Data</span><span class="pun">.</span><span class="typ">List</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Foreign</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Foreign</span><span class="pun">.</span><span class="pln">C</span></span><span class="pln">
</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">System</span><span class="pun">.</span><span class="typ">Random</span></span><span class="pln">

</span><span class="kw"><span class="kwd">import</span></span><span class="pln"> </span><span class="dt"><span class="typ">Criterion</span><span class="pun">.</span><span class="typ">Main</span></span><span class="pln">

main </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><span class="pln">
  </span><span class="kw"><span class="pln">let</span></span><span class="pln"> len </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="dv"><span class="lit">1000</span></span><span class="pln">
  xs </span><span class="ot"><span class="pun">&lt;-</span></span><span class="pln"> replicateM len </span><span class="fu"><span class="pln">$</span></span><span class="pln"> randomRIO </span><span class="pun">(</span><span class="dv"><span class="lit">0</span></span><span class="pun">,</span><span class="pln"> </span><span class="dv"><span class="lit">1000</span></span><span class="pun">)</span><span class="pln">
  defaultMain
    </span><span class="pun">[</span><span class="pln"> bgroup </span><span class="st"><span class="str">"sort"</span></span><span class="pln">
      </span><span class="pun">[</span><span class="pln"> bench </span><span class="st"><span class="str">"c++"</span></span><span class="pln">     </span><span class="fu"><span class="pln">$</span></span><span class="pln"> whnfIO </span><span class="fu"><span class="pln">$</span></span><span class="pln"> withArrayLen </span><span class="pun">(</span><span class="fu"><span class="pln">map</span></span><span class="pln"> </span><span class="fu"><span class="pln">fromIntegral</span></span><span class="pln"> xs</span><span class="pun">)</span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="pln"> \len ptr </span><span class="ot"><span class="pun">-&gt;</span></span><span class="pln">
         vsort ptr </span><span class="pun">(</span><span class="fu"><span class="pln">fromIntegral</span></span><span class="pln"> len</span><span class="pun">)</span><span class="pln">
      </span><span class="pun">,</span><span class="pln"> bench </span><span class="st"><span class="str">"haskell"</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="pln"> nf </span><span class="fu"><span class="pln">sort</span></span><span class="pln"> </span><span class="pun">(</span><span class="ot"><span class="pln">xs </span><span class="pun">::</span></span><span class="pln"> </span><span class="pun">[</span><span class="dt"><span class="typ">Int</span></span><span class="pun">])</span><span class="pln">
      </span><span class="pun">]</span><span class="pln">
    </span><span class="pun">]</span><span class="pln">

foreign </span><span class="kw"><span class="kwd">import</span></span><span class="pln"> ccall</span><span class="ot"><span class="pln"> vsort </span><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">Ptr</span></span><span class="pln"> </span><span class="dt"><span class="typ">CInt</span></span><span class="pln"> </span><span class="ot"><span class="pun">-&gt;</span></span><span class="pln"> </span><span class="dt"><span class="typ">CInt</span></span><span class="pln"> </span><span class="ot"><span class="pun">-&gt;</span></span><span class="pln"> </span><span class="dt"><span class="pln">IO</span></span><span class="pln"> </span><span class="pun">()</span></code></pre></article><article><h3>ベンチマーク実行</h3><pre class="prettyprint"><code class="sourceCode haskell"><span class="fu"><span class="pun">&gt;</span></span><span class="pln"> cabal bench
</span><span class="dt"><span class="typ">Running</span></span><span class="pln"> </span><span class="dv"><span class="lit">1</span></span><span class="pln"> benchmarks</span><span class="fu"><span class="pun">...</span></span><span class="pln">
</span><span class="dt"><span class="typ">Benchmark</span></span><span class="pln"> hoge</span><span class="fu"><span class="pun">-</span></span><span class="pln">bench</span><span class="fu"><span class="pun">:</span></span><span class="pln"> </span><span class="fu"><span class="pln">RUNNING</span><span class="pun">...</span></span><span class="pln">
warming up
estimating clock resolution</span><span class="fu"><span class="pun">...</span></span><span class="pln">
</span><span class="fu"><span class="pun">...</span></span><span class="pln">

benchmarking </span><span class="fu"><span class="pln">sort</span><span class="pun">/</span></span><span class="pln">c</span><span class="fu"><span class="pun">++</span></span><span class="pln">
mean</span><span class="fu"><span class="pun">:</span></span><span class="pln"> </span><span class="fl"><span class="lit">54.11847</span></span><span class="pln"> us</span><span class="pun">,</span><span class="pln"> lb </span><span class="fl"><span class="lit">53.89714</span></span><span class="pln"> us</span><span class="pun">,</span><span class="pln"> ub </span><span class="fl"><span class="lit">54.40775</span></span><span class="pln"> us</span><span class="pun">,</span><span class="pln"> ci </span><span class="fl"><span class="lit">0.950</span></span><span class="pln">
std dev</span><span class="fu"><span class="pun">:</span></span><span class="pln"> </span><span class="fl"><span class="lit">1.288492</span></span><span class="pln"> us</span><span class="pun">,</span><span class="pln"> lb </span><span class="fl"><span class="lit">1.016472</span></span><span class="pln"> us</span><span class="pun">,</span><span class="pln"> ub </span><span class="fl"><span class="lit">1.923825</span></span><span class="pln"> us</span><span class="pun">,</span><span class="pln"> ci </span><span class="fl"><span class="lit">0.950</span></span><span class="pln">
found </span><span class="dv"><span class="lit">5</span></span><span class="pln"> outliers among </span><span class="dv"><span class="lit">100</span></span><span class="pln"> samples </span><span class="pun">(</span><span class="fl"><span class="lit">5.0</span></span><span class="fu"><span class="pun">%</span></span><span class="pun">)</span><span class="pln">
  </span><span class="dv"><span class="lit">4</span></span><span class="pln"> </span><span class="pun">(</span><span class="fl"><span class="lit">4.0</span></span><span class="fu"><span class="pun">%</span></span><span class="pun">)</span><span class="pln"> high mild
  </span><span class="dv"><span class="lit">1</span></span><span class="pln"> </span><span class="pun">(</span><span class="fl"><span class="lit">1.0</span></span><span class="fu"><span class="pun">%</span></span><span class="pun">)</span><span class="pln"> high severe
variance introduced </span><span class="kwd">by</span><span class="pln"> outliers</span><span class="fu"><span class="pun">:</span></span><span class="pln"> </span><span class="fl"><span class="lit">17.107</span></span><span class="fu"><span class="pun">%</span></span><span class="pln">
variance </span><span class="kwd">is</span><span class="pln"> moderately inflated </span><span class="kwd">by</span><span class="pln"> outliers

benchmarking </span><span class="fu"><span class="pln">sort</span><span class="pun">/</span></span><span class="pln">haskell
mean</span><span class="fu"><span class="pun">:</span></span><span class="pln"> </span><span class="fl"><span class="lit">363.3632</span></span><span class="pln"> us</span><span class="pun">,</span><span class="pln"> lb </span><span class="fl"><span class="lit">361.8362</span></span><span class="pln"> us</span><span class="pun">,</span><span class="pln"> ub </span><span class="fl"><span class="lit">365.6127</span></span><span class="pln"> us</span><span class="pun">,</span><span class="pln"> ci </span><span class="fl"><span class="lit">0.950</span></span><span class="pln">
std dev</span><span class="fu"><span class="pun">:</span></span><span class="pln"> </span><span class="fl"><span class="lit">9.413442</span></span><span class="pln"> us</span><span class="pun">,</span><span class="pln"> lb </span><span class="fl"><span class="lit">7.040128</span></span><span class="pln"> us</span><span class="pun">,</span><span class="pln"> ub </span><span class="fl"><span class="lit">14.36999</span></span><span class="pln"> us</span><span class="pun">,</span><span class="pln"> ci </span><span class="fl"><span class="lit">0.950</span></span><span class="pln">
found </span><span class="dv"><span class="lit">4</span></span><span class="pln"> outliers among </span><span class="dv"><span class="lit">100</span></span><span class="pln"> samples </span><span class="pun">(</span><span class="fl"><span class="lit">4.0</span></span><span class="fu"><span class="pun">%</span></span><span class="pun">)</span><span class="pln">
  </span><span class="dv"><span class="lit">3</span></span><span class="pln"> </span><span class="pun">(</span><span class="fl"><span class="lit">3.0</span></span><span class="fu"><span class="pun">%</span></span><span class="pun">)</span><span class="pln"> high mild
  </span><span class="dv"><span class="lit">1</span></span><span class="pln"> </span><span class="pun">(</span><span class="fl"><span class="lit">1.0</span></span><span class="fu"><span class="pun">%</span></span><span class="pun">)</span><span class="pln"> high severe
variance introduced </span><span class="kwd">by</span><span class="pln"> outliers</span><span class="fu"><span class="pun">:</span></span><span class="pln"> </span><span class="fl"><span class="lit">19.973</span></span><span class="fu"><span class="pun">%</span></span><span class="pln">
variance </span><span class="kwd">is</span><span class="pln"> moderately inflated </span><span class="kwd">by</span><span class="pln"> outliers
</span><span class="dt"><span class="typ">Benchmark</span></span><span class="pln"> hoge</span><span class="fu"><span class="pun">-</span></span><span class="pln">bench</span><span class="fu"><span class="pun">:</span></span><span class="pln"> </span><span class="dt"><span class="pln">FINISH</span></span></code></pre></article><article><h3>結果</h3><p><a href="file:///C:/Users/tanakh/Dropbox/draft/pfi-seminar-2012-07-19/result.html" alt="">結果</a></p><iframe src="pfi-seminar-2012-07-19_files/a_002.htm">
</iframe>
</article><article><h2>まとめ</h2></article><article><h3>まとめ</h3><ul><li><p>QuickCheckでC++でもハッピープロパティテストライフを</p></li><li><p>ベンチも取れるよ</p></li><li><p>Haskellのツールチェインたのしい</p></li></ul></article><div id="prev-slide-area" class="slide-area"></div><div id="next-slide-area" class="slide-area"></div></section><link href="pfi-seminar-2012-07-19_files/css.css" type="text/css" rel="stylesheet"><link href="pfi-seminar-2012-07-19_files/styles.css" type="text/css" rel="stylesheet"><script src="pfi-seminar-2012-07-19_files/prettify.txt" type="text/javascript"></script></body></html>