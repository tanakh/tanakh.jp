
(function($,setTimeout){function noop(){}
function genericCallback(data){lastValue=[data];}
function appendScript(node){head.insertBefore(node,head.firstChild);}
function callIfDefined(method,object,parameters){return method&&method.apply(object.context||object,parameters);}
function qMarkOrAmp(url){return(/\?/).test(url)?"&":"?";}
var
STR_ASYNC="async",STR_CHARSET="charset",STR_EMPTY="",STR_ERROR="error",STR_JQUERY_JSONP="_jqjsp",STR_ON="on",STR_ONCLICK=STR_ON+"click",STR_ONERROR=STR_ON+STR_ERROR,STR_ONLOAD=STR_ON+"load",STR_ONREADYSTATECHANGE=STR_ON+"readystatechange",STR_REMOVE_CHILD="removeChild",STR_SCRIPT_TAG="<script/>",STR_SUCCESS="success",STR_TIMEOUT="timeout",browser=$.browser,head=$("head")[0]||document.documentElement,pageCache={},count=0,lastValue,xOptionsDefaults={callback:STR_JQUERY_JSONP,url:location.href};function jsonp(xOptions){xOptions=$.extend({},xOptionsDefaults,xOptions);var completeCallback=xOptions.complete,dataFilter=xOptions.dataFilter,callbackParameter=xOptions.callbackParameter,successCallbackName=xOptions.callback,cacheFlag=xOptions.cache,pageCacheFlag=xOptions.pageCache,charset=xOptions.charset,url=xOptions.url,data=xOptions.data,timeout=xOptions.timeout,pageCached,done=0,cleanUp=noop;xOptions.abort=function(){!done++&&cleanUp();};if(callIfDefined(xOptions.beforeSend,xOptions,[xOptions])===false||done){return xOptions;}
url=url||STR_EMPTY;data=data?((typeof data)=="string"?data:$.param(data,xOptions.traditional)):STR_EMPTY;url+=data?(qMarkOrAmp(url)+data):STR_EMPTY;callbackParameter&&(url+=qMarkOrAmp(url)+encodeURIComponent(callbackParameter)+"=?");!cacheFlag&&!pageCacheFlag&&(url+=qMarkOrAmp(url)+"_"+(new Date()).getTime()+"=");url=url.replace(/=\?(&|$)/,"="+successCallbackName+"$1");function notifySuccess(json){!done++&&setTimeout(function(){cleanUp();pageCacheFlag&&(pageCache[url]={s:[json]});dataFilter&&(json=dataFilter.apply(xOptions,[json]));callIfDefined(xOptions.success,xOptions,[json,STR_SUCCESS]);callIfDefined(completeCallback,xOptions,[xOptions,STR_SUCCESS]);},0);}
function notifyError(type){!done++&&setTimeout(function(){cleanUp();pageCacheFlag&&type!=STR_TIMEOUT&&(pageCache[url]=type);callIfDefined(xOptions.error,xOptions,[xOptions,type]);callIfDefined(completeCallback,xOptions,[xOptions,type]);},0);}
pageCacheFlag&&(pageCached=pageCache[url])?(pageCached.s?notifySuccess(pageCached.s[0]):notifyError(pageCached)):setTimeout(function(script,scriptAfter,timeoutTimer){if(!done){timeoutTimer=timeout>0&&setTimeout(function(){notifyError(STR_TIMEOUT);},timeout);cleanUp=function(){timeoutTimer&&clearTimeout(timeoutTimer);script[STR_ONREADYSTATECHANGE]=script[STR_ONCLICK]=script[STR_ONLOAD]=script[STR_ONERROR]=null;head[STR_REMOVE_CHILD](script);scriptAfter&&head[STR_REMOVE_CHILD](scriptAfter);};window[successCallbackName]=genericCallback;script=$(STR_SCRIPT_TAG)[0];script.id=STR_JQUERY_JSONP+count++;if(charset){script[STR_CHARSET]=charset;}
function callback(result){(script[STR_ONCLICK]||noop)();result=lastValue;lastValue=undefined;result?notifySuccess(result[0]):notifyError(STR_ERROR);}
if(browser.msie){script.event=STR_ONCLICK;script.htmlFor=script.id;script[STR_ONREADYSTATECHANGE]=function(){/loaded|complete/.test(script.readyState)&&callback();};}else{script[STR_ONERROR]=script[STR_ONLOAD]=callback;browser.opera?((scriptAfter=$(STR_SCRIPT_TAG)[0]).text="jQuery('#"+script.id+"')[0]."+STR_ONERROR+"()"):script[STR_ASYNC]=STR_ASYNC;;}
script.src=url;appendScript(script);scriptAfter&&appendScript(scriptAfter);}},0);return xOptions;}
jsonp.setup=function(xOptions){$.extend(xOptionsDefaults,xOptions);};$.jsonp=jsonp;})(jQuery,setTimeout);function SSBandInteraction(config){this.config=config;this._init();}
SSBandInteraction.prototype._init=function(){var that=this;var container=this.config.container;container.bind('mousedown',function(e){if(e.which!==1){return;}
var offset=$(this).offset();that.startX=e.pageX-offset.left;container.bind('mouseup',function(e){if(e.target.tagName.toUpperCase()==='A'){window.open(e.target.href);}else{var offset=$(this).offset();var endX=e.pageX-offset.left;if(Math.abs(that.startX-endX)<20){$(that).trigger({type:'bandclick',ssData:{x:endX}});}}
container.unbind('mouseup');});});$(container).bind('click',function(e){e.preventDefault();});$(this).bind('bandclick',function(e){e.preventDefault();var x=e.ssData.x;var bandSize=that.config.width/3;if(x<bandSize){$(that).trigger('bandprevious');}else if(x>(bandSize*2)){$(that).trigger('bandnext');}});};SSBandInteraction.prototype.activate=function(){var that=this;$(this).bind('bandprevious',function(){$.slideshareEventManager.trigger('previous');});$(this).bind('bandnext',function(){$.slideshareEventManager.trigger('next');});};SSBandInteraction.prototype.deactivate=function(){$(this).unbind('bandprevious');$(this).unbind('bandnext');};SSBandInteraction.prototype.destroy=function(){};if($.slideshareEventHandler===undefined){$.extend({slideshareEventManager:{SHOUTEVENTS:{'next':true,'previous':true,'gotoslide':true,'slidechanged':true},functions:{'gotofirstslide':function(){this.controller.play(1);},'next':function(){var controller=this.controller;var currentPosition=controller.currentPosition;var lastPosition=controller.slideCount;if(currentPosition===lastPosition){controller.displayLastScreen();}else{controller.play(currentPosition+1);}},'previous':function(){var controller=this.controller;controller.play(controller.currentPosition-1);},'gotolastslide':function(){var controller=this.controller;var lastPosition=controller.slideCount;controller.play(lastPosition);},'gotoslide':function(data){var controller=this.controller;controller.play(data.index);},'viewonss':function(e){var controller=this.controller;window.open(controller.config.slideview_url,'viewer');},'viewfullscreen':function(e){var controller=this.controller;if(controller.config.inpage_full_screen){if(controller.currentViewMode==='fullscreen'){controller.switchView('normal');}else{controller.switchView('fullscreen');}}else{if(controller.config.is_fullscreen){try{window.close();}catch(exception){}}else{window.open(controller.getFullScreenUrl(),'viewer','width='+screen.width+',height='+screen.height);}}},'zoomin':function(e){var controller=this.controller;controller.currentComponentSet.slidedisplayer.zoomin();},'zoomout':function(e){var controller=this.controller;controller.currentComponentSet.slidedisplayer.zoomout();},'playersearch':function(e){},'playershare':function(e){this.controller.displayShareScreen();},'metadataloaded':function(data){var controller=this.controller;var metaDataType=data.type;var handlers=controller._metaDataHandlers()[metaDataType];handlers.success.call(controller,data.json);},'metadataloadfailed':function(data){var controller=this.controller;var metaDataType=data.type;var handlers=controller._metaDataHandlers()[metaDataType];handlers.failure.call(controller);},'slidechanged':function(data){var slideIndex=data.index;var controller=this.controller;var currentPosition=controller.currentPosition;if(currentPosition===slideIndex&&!data.force){return;}
controller.updateCurrentPosition(slideIndex);controller._load(slideIndex);controller.currentComponentSet.slidedisplayer._scrollTo(slideIndex);},'currentversionloaded':function(data){var slide=this.controller.slides[data.index];var resourceKey=data.resourceKey;slide.updateRenderedResourceVersion(resourceKey);},'resourceloaded':function(data){var slide=this.controller.slides[data.index];var resourceKey=data.resourceKey;slide.updateResource(resourceKey,{status:'cached'});if(slide.status==='failed'){return;}
var resources=slide.resources,key;for(key in resources){if(resources[key].cacheable===true&&resources[key].status!=='cached'){return;}}
slide.status='cached';$.slideshareEventManager.trigger('slideloaded',{index:data.index});},'resourceloadfailed':function(data){var slide=this.controller.slides[data.index];var resourceKey=data.resourceKey;slide.updateResource(resourceKey,{status:'failed'});if(slide.resources[resourceKey].isCritical===true){slide.status='failed';$.slideshareEventManager.trigger('slideloadfailed',{index:data.index});}},'slideloaded':function(data){var slide=this.controller.slides[data.index];if(slide.currentViewMode.rendered){slide.paint();}},'slideloadfailed':function(data){var slide=this.controller.slides[data.index];if(slide.currentViewMode.rendered){slide.displayError();}},'slideloading':function(data){var slide=this.controller.slides[data.index];if(slide.currentViewMode.rendered){slide.displayLoading();}},'repaint':function(data){this.controller.repaint();}},registerController:function(controller){this.controller=controller;},registerPlayer:function(player){this.player=$(player);},trigger:function(eventname,data){var that=this;if(this.functions[eventname]!==undefined){this.functions[eventname].call(this,data);}
if(this.SHOUTEVENTS[eventname]){this.player.trigger({type:eventname,ssData:data});}}}});}function SSLastScreen(config){this.config=config;this.html=config.settings.html;this.related=this.config.settings.related;this.relatedPerScreen=2;this.relatedScreenIndex=0;this._init();}
SSLastScreen.prototype._init=function(){};SSLastScreen.prototype.show=function(dimensions){if(this.overlay!==undefined){return;}
this.overlay=$('<div/>').css({width:'100%',height:'100%','background-color':'black',opacity:0.75,position:'absolute',top:0,left:0}).appendTo(this.config.renderTo);this.lastScreen=$('<div/>').addClass('lastScreenContainer').html(this.html).appendTo(this.config.renderTo);this.setDimensions(dimensions);this.populateTemplate();this.bindEvents();};SSLastScreen.prototype.populateTemplate=function(){this.lastScreen.find('.lastScreenEmbedCode').val(this.config.settings.embed_code);this.lastScreen.find('.lastScreenSSUrl').val(this.config.settings.url);this.populateRelated(0,this.lastScreen.find('.relatedPresentation ul>li.relatedContent'));};SSLastScreen.prototype.populateRelated=function(index,elements){var i,j,start,end;var template,relatedItem;start=this.relatedPerScreen*index;if(start>this.related.length){return;}
end=start+this.relatedPerScreen-1;this.relatedScreenIndex=index;for(i=start,j=0;i<=end;i++,j++){relatedItem=this.related[i];template=$(elements[j]);if(typeof relatedItem==='undefined'){template.hide();}else{template.show();template.find('.relatedThumb img').attr('src',relatedItem.thumbnail);template.find('.relatedThumb').attr('href',relatedItem.url);template.find('.relatedTitle').text(relatedItem.title).attr('href',relatedItem.url);template.find('.relatedAuthor').text(relatedItem.author).attr('href','/'+relatedItem.author_login);template.find('.relatedViews').text(relatedItem.views);}}
this.rebindRotateTimeout();};SSLastScreen.prototype.rotateRelated=function(direction){var relatedElems=this.lastScreen.find('.relatedPresentation ul>li.relatedContent');var newIndex;if(direction==='back'){newIndex=this.relatedScreenIndex-1;if(newIndex<0){newIndex=(parseInt((this.related.length-1)/this.relatedPerScreen,10));}}else{newIndex=this.relatedScreenIndex+1;if(newIndex>(parseInt((this.related.length-1)/this.relatedPerScreen,10))){newIndex=0;}}
this.populateRelated(newIndex,relatedElems);};SSLastScreen.prototype.rebindRotateTimeout=function(){var that=this;if(this.rotateIntervalId){clearTimeout(this.rotateIntervalId);}
this.rotateIntervalId=setTimeout(function(){that.rotateRelated('front');},3000);};SSLastScreen.prototype.destroy=function(){if(this.rotateIntervalId){clearTimeout(this.rotateIntervalId);}
this.overlay.remove();delete(this.overlay);this.lastScreen.remove();delete(this.lastScreen);};SSLastScreen.prototype.bindEvents=function(){var that=this;this.lastScreen.find('.close').bind('click',function(e){e.preventDefault();that.destroy();});this.lastScreen.find('input[type=text]').bind('focus',function(){this.select();});this.lastScreen.find('.lastScreenEmailShare').bind('click',function(e){e.preventDefault();that.destroy();$.slideshareEventManager.trigger('playershare');});this.lastScreen.find('.lastScreenReplay').bind('click',function(e){e.preventDefault();that.destroy();$.slideshareEventManager.trigger('gotofirstslide');});this.lastScreen.find('.lastScreenNext').bind('click',function(e){e.preventDefault();that.rotateRelated('front');});this.lastScreen.find('.lastScreenPrev').bind('click',function(e){e.preventDefault();that.rotateRelated('back');});};SSLastScreen.prototype.setDimensions=function(dimensions){if(this.lastScreen===undefined){return;}
this.lastScreen.css({height:dimensions.height,width:dimensions.width});};function SSReplayScreen(config){this.config=config;this.html=config.settings.html;this._init();}
SSReplayScreen.prototype._init=function(){};SSReplayScreen.prototype.show=function(dimensions){if(this.overlay!==undefined){return;}
this.overlay=$('<div/>').css({width:'100%',height:'100%','background-color':'black',opacity:0.75,position:'absolute',top:0,left:0}).appendTo(this.config.renderTo);this.lastScreen=$('<div/>').css({position:'absolute'}).html(this.html).appendTo(this.config.renderTo);this.setDimensions(dimensions);this.bindEvents();};SSReplayScreen.prototype.destroy=function(){this.overlay.remove();delete(this.overlay);this.lastScreen.remove();delete(this.lastScreen);};SSReplayScreen.prototype.bindEvents=function(){var that=this;this.lastScreen.find('.replayScreenReplay').bind('click',function(e){e.preventDefault();that.destroy();$.slideshareEventManager.trigger('gotofirstslide');});};SSReplayScreen.prototype.setDimensions=function(dimensions){if(this.lastScreen===undefined){return;}
var layerWidth=93;var layerHeight=25;var top,left;top=(dimensions.height-layerHeight)/2;left=(dimensions.width-layerWidth)/2;if(top<0){top=0;}else{top=parseInt(top,10);}
if(left<0){left=0;}else{left=parseInt(left,10);}
this.lastScreen.css({top:top,left:left});};function SSResource(config){if(typeof config==='undefined'){return;}
this.TIMEOUT_LIMIT=10000;this.config=config;this.resourceKey=config.resourceKey;this._init();}
SSResource.prototype._init=function(){this._initResourceConfig();this.status='initialized';};SSResource.prototype.load=function(){this.status='loading';this.startTime=(new Date()).getTime();this._tryLoad();};SSResource.prototype.update=function(values){var key,value;for(key in values){value=values[key];if(this.resourceKey==='image'&&key==='newSize'){this.addImageSize(value);}else{this[key]=value;}}};SSResource.prototype.resourceErrorInternalHandler=function(){var that=this;return function(data){var startTime=that.startTime;var elapsedTime=(new Date()).getTime()-startTime;var retries=that.retries;if(retries>0&&elapsedTime<that.TIMEOUT_LIMIT){retries=retries-1;that.update({retries:retries});setTimeout(function(){that._tryLoad();},1000);}else{$.slideshareEventManager.trigger('resourceloadfailed',{index:that.config.slideIndex,resourceKey:that.resourceKey});}};};function SSShareScreen(config){this.config=config;this.html=config.settings.html;this._init();}
SSShareScreen.prototype._init=function(){};SSShareScreen.prototype.show=function(dimensions){if(this.overlay!==undefined){return;}
this.overlay=$('<div/>').css({width:'100%',height:'100%','background-color':'black',opacity:0.75,position:'absolute',top:0,left:0}).appendTo(this.config.renderTo);this.shareScreen=$('<div/>').css({position:'absolute'}).html(this.html).appendTo(this.config.renderTo);this.setDimensions(dimensions);this.populateTemplate();this.bindEvents();};SSShareScreen.prototype.populateTemplate=function(){this.shareScreen.find('.shareScreenEmbedCode').val(this.config.settings.embed_code);this.shareScreen.find('.shareScreenSSUrl').val(this.config.settings.url);this.shareScreen.find('.shareScreenFromName').val(this.config.settings.user_name);};SSShareScreen.prototype.destroy=function(){this.overlay.remove();delete(this.overlay);this.shareScreen.remove();delete(this.shareScreen);};SSShareScreen.prototype.bindEvents=function(){var that=this;this.shareScreen.find('.close').bind('click',function(e){e.preventDefault();that.destroy();});this.shareScreen.find('input[type=text]').bind('focus',function(){this.select();});var emailSubmit=this.shareScreen.find('input[type=submit]');this.shareScreen.find('form').bind('submit',function(e){e.preventDefault();});emailSubmit.bind('click',function(e){e.preventDefault();var from=that.shareScreen.find('.shareScreenFromName').val();var to=that.shareScreen.find('.shareScreenMailID').val();if(from.length===0||to.length===0){return;}
if(typeof that.emailProgress!=='undefined'){that.emailProgress.remove();}
that.emailProgress=$('<span/>').text('sending...');emailSubmit.parent().prepend(that.emailProgress);$.ajax({url:'/share/contacts/'+that.config.settings.slideshow_id,type:'POST',data:{'message[from]':from,'message[to]':to},dataType:'json',success:function(data){if(data.success===true){that.emailProgress.text('Sent');}else{that.emailProgress.text('Sending failed');}},error:function(){that.emailProgress.text('Sending failed');}});});$.each({'.thirdPartyShare a.Twitter':this.config.settings.twitter_share,'.thirdPartyShare a.Facebook':this.config.settings.facebook_share,'.thirdPartyShare a.Linkedin':this.config.settings.linkedin_share},function(selector,url){that.shareScreen.find(selector).bind('click',function(e){e.preventDefault();window.open(url,'ss_share','width=660,height=490,toolbar=no,resizable=fixed,status=no,scrollbars=no,'+'menubar=no,screenX=0,screenY=0').focus();});});};SSShareScreen.prototype.setDimensions=function(dimensions){if(this.shareScreen===undefined){return;}
var layerWidth=520;var layerHeight=260;var top,left;top=(dimensions.height-layerHeight)/2;left=(dimensions.width-layerWidth)/2;if(top<0){top=0;}else{top=parseInt(top,10);}
if(left<0){left=0;}else{left=parseInt(left,10);}
this.shareScreen.css({top:top,left:left});};function SSSlide(config){if(typeof config==="undefined"){return;}
this.config=config;this.index=config.index;this.contentWidth=this.config.contentWidth;this.contentHeight=this.config.contentHeight;delete(this.config.contentWidth);delete(this.config.contentHeight);this._init();}
SSSlide.prototype._init=function(){this.status='initialized';this.viewModes={};this.resources={};var urls=this._createResources();this._bindEvents();};SSSlide.prototype._createResources=function(){switch(this.config.slideMode){case'image':this.resources.image=new SSFallbackImageResource({baseUrl:this.config.imageBucketLocation,timestamp:this.config.timestamp,resourceKey:'image',indexGenerator:this.config.indexGenerator,playerWidth:this.config.playerWidth,slideIndex:this.index});break;case'html':this.resources.image=new SSBgImageResource({baseUrl:this.config.bucketLocation,bgImageFormats:this.config.bgImageFormats,timestamp:this.config.timestamp,resourceKey:'image',indexGenerator:this.config.indexGenerator,playerWidth:this.config.playerWidth,slideIndex:this.index});this.resources.html=new SSHtmlResource({baseUrl:this.config.bucketLocation,timestamp:this.config.timestamp,resourceKey:'html',indexGenerator:this.config.indexGenerator,slideIndex:this.index});break;}};SSSlide.prototype.load=function(){if(this.status==='cached'){this._getNewResourceVersions(this.currentViewMode.wrapperWidth);$.slideshareEventManager.trigger('slideloaded',{index:this.index});return;}
if(this.status==='loading'){$.slideshareEventManager.trigger('slideloading',{index:this.index});return;}
if(this.status==='failed'){$.slideshareEventManager.trigger('slideloadfailed',{index:this.index});return;}
this.status='loading';$.slideshareEventManager.trigger('slideloading',{index:this.index});var that=this;var reskey;for(reskey in this.resources){resource=this.resources[reskey];resource.status='loading';resource.load();}};SSSlide.prototype.updateResource=function(reskey,values){if(typeof this.resources[reskey]==='undefined'){return;}
this.resources[reskey].update(values);};SSSlide.prototype.displayError=function(){this.empty();$('<img/>').attr({src:this.config.errorImageUrl}).css({width:this.currentViewMode.width,height:this.currentViewMode.height,top:this.PADDING,left:this.PADDING,position:'absolute',border:0}).appendTo(this.currentViewMode.wrapper);};SSSlide.prototype.paint=function(){if(typeof this.currentViewMode.imageElement==='undefined'){this.render();}
this.currentViewMode.imageElement.css({width:this.currentViewMode.width,height:this.currentViewMode.height});if(this.config.slideMode==='html'){var zoomStyles;if(Modernizr.csstransforms){zoomStyles={'-moz-transform':'scale('+this.currentViewMode.contentScale+')','-webkit-transform':'scale('+this.currentViewMode.contentScale+')','-o-transform':'scale('+this.currentViewMode.contentScale+')','msTransform':'scale('+this.currentViewMode.contentScale+')','-moz-transform-origin':'0 0','-webkit-transform-origin':'0 0','-o-transform-origin':'0 0','msTransformOrigin':'0 0'};}else{zoomStyles={'zoom':this.currentViewMode.contentScale};}
this.currentViewMode.contentElement.css({width:this.currentViewMode.width,height:this.currentViewMode.height});this.currentViewMode.contentElement.children('.ssml_div').css(zoomStyles);}};SSSlide.prototype.render=function(){this.empty();this.currentViewMode.imageElement=$('<img/>').css({position:'absolute',top:this.PADDING,left:this.PADDING,margin:0,padding:0}).attr({src:this.resources.image.getContent()}).appendTo(this.currentViewMode.wrapper);if(this.config.slideMode==='html'){var styleData='<style>'+this.resources.html.getContent().style+'</style>';$(styleData).appendTo(this.currentViewMode.wrapper);this.currentViewMode.contentElement=$('<div/>').css({position:'absolute',overflow:'hidden'}).html(this.resources.html.getContent().html);this.currentViewMode.contentElement.appendTo(this.currentViewMode.wrapper);if(this.index===1&&window.jsplayerFirstSlideRenderTime===undefined){window.jsplayerFirstSlideRenderTime=new Date();var timeDiff=jsplayerFirstSlideRenderTime-jsplayerInitTime;if(window._gaq!==undefined){window._gaq.push(['_trackEvent','jsplayer','firstsliderendertime',this.config.stripped_title,parseInt(timeDiff/10,10)]);}}}};SSSlide.prototype._getNewResourceVersions=function(){this.resources.image._tryLoad(this.currentViewMode.wrapperWidth);};SSSlide.prototype.updateRenderedResourceVersion=function(resourceKey){if(!this.currentViewMode.rendered){return;}
if(resourceKey==='image'&&this.currentViewMode.imageElement!==undefined){this.currentViewMode.imageElement.attr({src:this.resources.image.getContent()});}};SSSlide.prototype._bindEvents=function(){};function SSSlideDisplayer(config){if(typeof config==="undefined"){return;}
this.config=config;this.slideOffsets=[];this.state='initialized';this.zoomIndex=0;this._init();}
SSSlideDisplayer.prototype._init=function(){var that=this;this.container=$('<div/>').attr({'class':'slideDisplayer'}).css({position:'relative',overflow:'hidden',height:'100%',width:'100%','text-align':'left'}).appendTo(this.config.renderTo);this.showInitializer();};SSSlideDisplayer.prototype.hideInitializer=function(){this.container.empty();};SSSlideDisplayer.prototype.error=function(){var height,width;height=this.container.height();width=this.container.width();this.hideInitializer();$('<img/>').attr({src:this.config.errorImageUrl}).css({width:width,height:height,top:0,left:0,position:'absolute'}).appendTo(this.container);};SSSlideDisplayer.prototype.zoomin=function(){var newZoomIndex=this.zoomIndex+1;if(newZoomIndex===this.zoomLevels.length){return;}
this.zoomIndex=newZoomIndex;this.setZoom(newZoomIndex);$(this).trigger('zoomchanged');};SSSlideDisplayer.prototype.zoomout=function(){if(this.zoomIndex===0){return;}
this.zoomIndex-=1;this.setZoom(this.zoomIndex);$(this).trigger('zoomchanged');};SSSlideDisplayer.prototype.activate=function(){};SSSlideDisplayer.prototype.deactivate=function(){};SSSlideDisplayer.prototype.destroy=function(){this.container.remove();};function SSToolbar(config){this.config=config;this._init();this._ELEMENTS=this.getElements();this._ELEMENT_PRIORITIES={1:['nav'],5:['viewOnSS'],2:['fullScreen','leaveFullScreen'],3:['share'],4:['goToSlide'],6:['zoomButtons']};this._ELEMENT_VISIBILITY={'share':!this.config.disableShare,'fullScreen':!this.config.isFullScreen,'leaveFullScreen':this.config.isFullScreen,'viewOnSS':this.config.enableViewSS,'zoomButtons':(this.config.playerType=='document'),'nav':true,'goToSlide':true};this._ELEMENT_SECTION={'nav':'one','share':'two','fullScreen':'two','leaveFullScreen':'two','goToSlide':'two','viewOnSS':'one','zoomButtons':'two'};if(this.config.playerType=='document'){this._ELEMENT_WIDTHS={'nav':30,'share':72,'fullScreen':24,'leaveFullScreen':24,'goToSlide':57,'viewOnSS':88,'zoomButtons':56};this._ELEMENT_SECTION.share='one';}else{this._ELEMENT_WIDTHS={'nav':57,'share':35,'fullScreen':24,'leaveFullScreen':24,'goToSlide':57,'viewOnSS':88};}
this.config.toolbarPadding=6;}
SSToolbar.prototype._init=function(){this.container=$('<div/>').attr({'class':'toolbar'}).css({height:this.config.height}).html(this.config.html).appendTo(this.config.renderTo);if(this.config.disableShare){this.container.find('.btnShare').hide();}
if(this.config.enableViewSS){this.container.find('.btnViewOnSS').show();}
if(this.config.isFullScreen){this.container.find('.btnFullScreen').hide();this.container.find('.btnLeaveFullScreen').show();}
var that=this;this.container.find('.goToSlideLabel>span').html('/'+this.config.slideCount);this.deactivate();};SSToolbar.prototype.getElements=function(){var container=this.container;var elementCodes={'nav':'.nav','share':'.btnShare','fullScreen':'.btnFullScreen','leaveFullScreen':'.btnLeaveFullScreen','viewOnSS':'.btnViewOnSS','goToSlide':'.goToSlideLabel','zoomButtons':'.docActions'};var elements={};$.each(elementCodes,function(code,selector){elements[code]=container.find(selector);});return elements;};SSToolbar.prototype.deactivate=function(){var buttons='.btnFirst, .btnPrevious, .btnNext, .btnLast, .btnSS, .btnViewOnSS, .btnFullScreen, .btnZoomOut, '+'.btnZoomIn, .btnFind, .btnShare';this.container.find(buttons).unbind('click');this.container.find(buttons).bind('click',function(e){e.preventDefault();e.stopPropagation();});this.container.find('.goToSlideLabel>input[type=text]').attr('disabled',true);};SSToolbar.prototype.activate=function(){var that=this;var container=this.container;var buttons='.btnFirst, .btnPrevious, .btnNext, .btnLast, .btnSS, .btnViewOnSS, .btnFullScreen, .btnZoomOut,'+' .btnZoomIn, .btnFind, .btnShare';container.find(buttons).unbind();$.each({'.btnViewOnSS':'viewonss','.btnFirst':'gotofirstslide','.btnSS':'viewonss','.btnPrevious':'previous','.btnNext':'next','.btnLast':'gotolastslide','.btnFullScreen':'viewfullscreen','.btnLeaveFullScreen':'viewfullscreen','.btnZoomOut':'zoomout','.btnZoomIn':'zoomin','.btnFind':'playersearch','.btnShare':'playershare'},function(selector,eventname){container.find(selector).bind('click',function(e){$.slideshareEventManager.trigger(eventname);e.preventDefault();e.stopPropagation();});});var gotoslideInput=this.container.find('.goToSlideLabel>input[type=text]');gotoslideInput.attr('disabled',false);gotoslideInput.bind('keyup',function(e){e.stopPropagation();if(e.keyCode===13){var input=$(e.target);var val=input.val();if(isNaN(val)){return;}else{var slidenumber=parseInt(val,10);$.slideshareEventManager.trigger('gotoslide',{index:slidenumber});}}});gotoslideInput.bind('focus',function(e){$(e.target).select();});};SSToolbar.prototype.setDimensions=function(dimensions){var that=this;var firstElementWidth=that._ELEMENT_WIDTHS[that._ELEMENT_PRIORITIES[1][0]];var sectionWidth=(dimensions.width/2)-that.config.toolbarPadding-firstElementWidth;var availableWidth={'one':sectionWidth,'two':sectionWidth};var priorityLength=this._ELEMENT_PRIORITIES.length;var priorityElement,priorityElementLength;var elementCode,elementWidth,elementVisibility,elementShowable;$.each(this._ELEMENT_PRIORITIES,function(priority,priorityElement){priorityElementLength=priorityElement.length;for(var j=0;j<priorityElementLength;j++){elementCode=priorityElement[j];var section=that._ELEMENT_SECTION[elementCode];elementWidth=that._ELEMENT_WIDTHS[elementCode];elementShowable=(that._ELEMENT_VISIBILITY[elementCode]&&availableWidth[section]>elementWidth);if(priority==1||elementShowable){that._ELEMENTS[elementCode].show();if(priority!=1){availableWidth[section]-=elementWidth;}}else{that._ELEMENTS[elementCode].hide();}}});};SSToolbar.prototype.updateCurrentPosition=function(position){this.container.find('.goToSlideLabel>input[type=text]').val(position);};SSToolbar.prototype.destroy=function(){this.container.remove();};function SSTouchInteraction(config){this.config=config;this._init();}
SSTouchInteraction.prototype._init=function(){var that=this;this.touch={active:false};this.touchMove=function(e){var evt=e.originalEvent;if(evt.touches.length>1){that.touch.active=false;}
that.touch.stop={time:(new Date()).getTime(),coords:[evt.touches[0].pageX,evt.touches[0].pageY]};if(Math.abs(that.touch.start.coords[0]-that.touch.stop.coords[0])>10){e.preventDefault();}};this.config.container.bind('touchstart',function(e){var evt=e.originalEvent;if(evt.touches.length===1){that.touch.active=true;that.touch.start={time:(new Date()).getTime(),coords:[evt.touches[0].pageX,evt.touches[0].pageY]};$(that.config.container).bind('touchmove',that.touchMove);}});this.config.container.bind('touchend',function(e){var evt=e.originalEvent;$(document).unbind('touchmove');if(!that.touch.active){return;}
var delta=that.touch.stop.coords[0]-that.touch.start.coords[0];if(Math.abs(delta)<50){return;}
if(delta<0){$(that).trigger('touchnext');}else{$(that).trigger('touchprevious');}});};SSTouchInteraction.prototype.activate=function(){var that=this;$(this).bind('touchprevious',function(){$.slideshareEventManager.trigger('previous');});$(this).bind('touchnext',function(){$.slideshareEventManager.trigger('next');});};SSTouchInteraction.prototype.deactivate=function(){$(this).unbind('touchprevious');$(this).unbind('touchnext');};SSTouchInteraction.prototype.destroy=function(){};function SSHtmlResource(config){this.resourceTemplate={prefix:config.baseUrl,key:'page_',suffix:'.js?'+config.timestamp,digitLength:4,cacheable:true,retries:2,isCritical:true};SSResource.call(this,config);}
SSHtmlResource.prototype=new SSResource();SSHtmlResource.prototype._initResourceConfig=function(){var resourceTemplate=this.resourceTemplate;var indexString=this.config.indexGenerator(this.config.slideIndex,resourceTemplate.digitLength);this.url=resourceTemplate.prefix+resourceTemplate.key+indexString+resourceTemplate.suffix;this.cacheable=resourceTemplate.cacheable;this.retries=resourceTemplate.retries||0;this.isCritical=resourceTemplate.isCritical;};SSHtmlResource.prototype._tryLoad=function(){$.jsonp({url:this.url,callback:'slideshare_jsonp_hook_trigger',success:this.resourceLoadedInternalHandler(),error:this.resourceErrorInternalHandler(),cache:true,timeout:10000});};SSHtmlResource.prototype.resourceLoadedInternalHandler=function(){var that=this;return function(data){var replacedStyle=data.style.replace(/a\.ssml_a \{.*?\}/,'').replace(/\.ssml_div span \{.*?\}/,'').replace(/\.ps([\s\S]*?)\{[\s\S]*?\}/g,'').replace(/@font-face[\s\S]*?\{[\s\S]*?\}/g,'');that.html=data.html;that.style=replacedStyle;$.slideshareEventManager.trigger('resourceloaded',{index:that.config.slideIndex,resourceKey:that.resourceKey});};};SSHtmlResource.prototype.getContent=function(){return{html:this.html,style:this.style};};function SSImageResource(config){SSResource.call(this,config);}
SSImageResource.prototype=new SSResource();SSImageResource.prototype._initResourceConfig=function(){this.suffixes=this._getSuffixes();var resourceTemplate=this.resourceTemplate;this.indexString=this.config.indexGenerator(this.config.slideIndex,resourceTemplate.digitLength);this.cacheable=resourceTemplate.cacheable;this.retries=resourceTemplate.retries||0;this.isCritical=resourceTemplate.isCritical;};SSImageResource.prototype._getUrl=function(suffix){return this.resourceTemplate.prefix+this.resourceTemplate.key+this.indexString+
suffix+'?'+this.config.timestamp;};SSImageResource.prototype._tryLoad=function(containerWidth){containerWidth=containerWidth||this.config.playerWidth;var width=this._getAppropriateWidth(containerWidth);var suffix=this.suffixes[width];var suffixval=suffix.value;var url=this._getUrl(suffixval);if(width===this.currentWidth&&suffix.status!=='initialized'){return;}
if(suffix.status==='failed'){(this.versionErrorInternalHandler(width,url))();return;}
this.currentWidth=width;if(suffix.status==='loading'){return;}
if(suffix.status==='loaded'){(this.versionLoadedInternalHandler(width,url))();return;}
suffix.status='loading';if(suffix.startTime===undefined){suffix.startTime=(new Date()).getTime();}
var img=new Image();$(img).bind('load',this.versionLoadedInternalHandler(width,url)).bind('error',this.versionErrorInternalHandler(width));img.src=url;};SSImageResource.prototype.versionLoadedInternalHandler=function(width,url){var that=this;return function(data){that.suffixes[width].status='loaded';if(that.status==='loading'){that.url=url;(that.resourceLoadedInternalHandler())();}else if(that.status==='cached'&&width===that.currentWidth){that.url=url;$.slideshareEventManager.trigger('currentversionloaded',{index:that.config.slideIndex,resourceKey:that.resourceKey});}};};SSImageResource.prototype.versionErrorInternalHandler=function(width){var that=this;return function(data){var suffix=that.suffixes[width];var startTime=suffix.startTime;var elapsedTime=(new Date()).getTime()-startTime;var retries=suffix.retries;if(retries>0&&elapsedTime<that.TIMEOUT_LIMIT){retries=retries-1;suffix.retries=retries;suffix.status='initialized';setTimeout(function(){that._tryLoad();},1000);}else{suffix.status='failed';if(that.status==='loading'&&width===that.currentWidth){var alternateResourceAvailable=false;var resWidth;for(resWidth in that.suffixes){var alternateSuffix=that.suffixes[width];if(alternateSuffix.status==='loading'||alternateSuffix.status=='loaded'){alternateResourceAvailable=true;}}
if(!alternateResourceAvailable){(that.resourceErrorInternalHandler())();}}}};};SSImageResource.prototype.resourceLoadedInternalHandler=function(){var that=this;return function(data){$.slideshareEventManager.trigger('resourceloaded',{index:that.config.slideIndex,resourceKey:that.resourceKey});};};SSImageResource.prototype.getContent=function(){var suffix=this.suffixes[this.currentWidth];if(suffix.status==='loaded'){return this.url;}
var width;for(width in this.suffixes){suffix=this.suffixes[width];if(suffix.status==='loaded'){url=this._getUrl(suffix.value);return url;}}
return this.url;};SSImageResource.prototype._getAppropriateWidth=function(playerWidth){var i,width,prevWidth;var imageSizes=this.imageSizes;var sizeLen=this.imageSizes.length;for(i=0;i<sizeLen;i++){width=this.imageSizes[i];prevWidth=width;if(playerWidth<=width){return width;}}
return prevWidth;};function SSMetaResource(config){this.resourceTemplate={url:config.url,cacheable:true,retries:2,isCritical:true};SSResource.call(this,config);}
SSMetaResource.prototype=new SSResource();SSMetaResource.prototype._initResourceConfig=function(){var resourceTemplate=this.resourceTemplate;this.url=resourceTemplate.url+'?'+this.config.timestamp;this.cacheable=resourceTemplate.cacheable;this.retries=resourceTemplate.retries||0;this.isCritical=resourceTemplate.isCritical;};SSMetaResource.prototype._tryLoad=function(){$.jsonp({url:this.url,callback:'slideshare_jsonp_meta_hook_trigger',success:this.resourceLoadedInternalHandler(),error:this.resourceErrorInternalHandler(),cache:true,timeout:10000});};SSMetaResource.prototype.resourceLoadedInternalHandler=function(){var that=this;return function(data){that.status='loaded';$.slideshareEventManager.trigger('metadataloaded',{type:that.config.type,json:data});};};SSMetaResource.prototype.resourceErrorInternalHandler=function(){var that=this;return function(data){var startTime=that.startTime;var elapsedTime=(new Date()).getTime()-startTime;var retries=that.retries;if(retries>0&&elapsedTime<that.TIMEOUT_LIMIT){retries=retries-1;that.update({retries:retries});setTimeout(function(){that._tryLoad();},1000);}else{$.slideshareEventManager.trigger('metadataloadfailed',{type:that.config.type});}};};function SSBgImageResource(config){this.imageSizes=[400];this.resourceTemplate={prefix:config.baseUrl,key:'output',digitLength:3,cacheable:true,retries:0,isCritical:true};SSImageResource.call(this,config);}
SSBgImageResource.prototype=new SSImageResource();SSBgImageResource.prototype._getSuffixes=function(){var bgImageFormats=this.config.bgImageFormats;delete(this.config.bgImageFormats);var suffixes={};for(var x in bgImageFormats){this.imageSizes.push(parseInt(x,10));}
var imageSizes=this.imageSizes;var suffix,imageSuffix,imageSize;for(var i=0;i<imageSizes.length;i++){imageSize=imageSizes[i];imageSuffix='';if(imageSize===400){imageSuffix='-400.jpg';}else{imageSuffix='-'+imageSize+'.'+bgImageFormats[imageSize];}
suffix={value:imageSuffix,status:'initialized',retries:2};suffixes[imageSize]=suffix;}
imageSize=imageSize+100;this.imageSizes.push(imageSize);suffixes[imageSize]={value:'.png',status:'initialized',retries:2};return suffixes;};function SSFallbackImageResource(config){this.imageSizes=[320,768];this.resourceTemplate={prefix:config.baseUrl,key:'-slide-',digitLength:1,cacheable:true,retries:0,isCritical:true};SSImageResource.call(this,config);}
SSFallbackImageResource.prototype=new SSImageResource();SSFallbackImageResource.prototype._getSuffixes=function(){var suffixes={};var imageSizes=this.imageSizes;var suffix,imageSuffix,imageSize;for(var i=0;i<imageSizes.length;i++){imageSize=imageSizes[i];imageSuffix='-'+imageSizes[i]+'.jpg';suffix={value:imageSuffix,status:'initialized',retries:2};suffixes[imageSize]=suffix;}
return suffixes;};SSFallbackImageResource.prototype.addImageSize=function(size){var newWidth=parseInt(size.width,10);if(isNaN(newWidth)){return;}
this.imageSizes.push(newWidth);this.imageSizes.sort(function(a,b){return a-b;});var newSuffix={value:'.jpg',status:'initialized',retries:2};this.suffixes[newWidth]=newSuffix;};function SSDocumentDisplayer(config){SSSlideDisplayer.call(this,config);this.zoomLevels=[1,1.2,1.5,1.75,2,2.5,3,4];this.prerenderedSlides=[];}
SSDocumentDisplayer.prototype=new SSSlideDisplayer();SSDocumentDisplayer.prototype._bindEvents=function(){var that=this;var i,slide;this.container.unbind('scroll');this.container.bind('scroll',function(e){var currentSlide=that.detectCurrentSlide();$.slideshareEventManager.trigger('slidechanged',{index:currentSlide});});};SSDocumentDisplayer.prototype._scrollTo=function(index){var topOffset=this.slides[index].currentViewMode.container.position().top;this.container.scrollTop(topOffset);};SSDocumentDisplayer.prototype.start=function(config){var i,slide;var slideContainers=[];if(this.slides===undefined){this.slides=config.slides;this.state='playing';this.hideInitializer();this.slidesContainer=$('<div/>').attr({'class':'slidesContainer'}).css({position:'relative','background-color':'#ccc'}).appendTo(this.container);for(i=1;i<=this.config.slideCount;i++){slideContainers[i]=$('<div/>').appendTo(this.slidesContainer);}}
for(i=1;i<=this.config.slideCount;i++){slide=this.slides[i];slide.setContainer({mode:config.mode,container:slideContainers[i]});}
this.setZoom(0);};SSDocumentDisplayer.prototype.showInitializer=function(){$('<div/>').css({width:this.container.width()-20,height:this.container.height()-20,padding:5,margin:5,top:0,left:0,'background-color':'#fff'}).html('Loading...').appendTo(this.container);};SSDocumentDisplayer.prototype.detectCurrentSlide=function(){var that=this;var viewHeight=this.height;var viewEdge1=this.container.scrollTop();var currentSlide=(function(){var i;for(i=1;i<that.config.slideCount;i++){var slideEdge1=that.slideOffsets[i];var slideEdge2=that.slideOffsets[i+1];if(viewEdge1>=slideEdge1&&viewEdge1<slideEdge2){return i;}}
return that.config.slideCount;})();return currentSlide;};SSDocumentDisplayer.prototype.setZoom=function(index){this.zoomIndex=index;var currentZoom=this.zoomLevels[this.zoomIndex];if(currentZoom===1){this.container.css({'overflow-y':'scroll','overflow-x':'hidden'});this.slidesContainer.width('100%');this.width=this.slidesContainer.width();}else{this.container.css({'overflow-y':'scroll','overflow-x':'scroll'});var zoomWidth=this.config.width*currentZoom;this.slidesContainer.width(zoomWidth);this.width=zoomWidth;}};SSDocumentDisplayer.prototype.getZoomDimensions=function(){var currentZoom=this.zoomLevels[this.zoomIndex];return{width:this.config.width*currentZoom,height:this.config.height*currentZoom,displayerWidth:this.width};};SSDocumentDisplayer.prototype.setDimensions=function(dimensions){var that=this;if(typeof dimensions==='object'){this.config.width=dimensions.width;this.config.height=dimensions.height;}
var partialUpdate=dimensions&&dimensions.partial;if(!partialUpdate&&this.state==='playing'){this.setZoom(this.zoomIndex);}
var zoomDimensions=this.getZoomDimensions();var zoomWidth=zoomDimensions.width;var zoomHeight=zoomDimensions.height;var slidesContainerWidth=zoomDimensions.displayerWidth;this.container.css({height:this.config.height,width:this.config.width});if(!partialUpdate&&this.state==='playing'){this.panelHeight=0;var i,slide,offset;offset=0;for(i=1;i<=this.config.slideCount;i++){slide=this.slides[i];slide.setDimensions({parentWidth:slidesContainerWidth,parentHeight:zoomHeight});this.slideOffsets[i]=offset;offset+=slide.wrapperOffset();}
this.height=offset;}};SSDocumentDisplayer.prototype.setPrerenderedSlides=function(config){var i;for(i=config.start;i<=config.end;i++){if($.inArray(i,this.prerenderedSlides)===-1){this.prerenderedSlides.push(i);}}};function SSDocumentSlide(config){SSSlide.call(this,config);this.PADDING=5;}
SSDocumentSlide.prototype=new SSSlide();SSDocumentSlide.prototype.wrapperOffset=function(){return this.currentViewMode.wrapperHeight;};SSDocumentSlide.prototype.empty=function(){this.currentViewMode.wrapper.empty();};SSDocumentSlide.prototype.displayLoading=function(){this.empty();$('<div/>').css({width:this.currentViewMode.width-10,height:this.currentViewMode.height-10,padding:5,top:0,left:0,'background-color':'#fff'}).html('Loading...').appendTo(this.currentViewMode.wrapper);};SSDocumentSlide.prototype.setDimensions=function(dimensions){var origwidth=this.contentWidth;var origheight=this.contentHeight;var contentAspect=origwidth/origheight;var viewWidth=dimensions.parentWidth-(this.PADDING*2);var viewHeight=dimensions.parentHeight-(this.PADDING*2);var viewAspect=viewWidth/viewHeight;var scale,contentScale,fontscale,width,height;var top,left;contentScale=viewWidth/origwidth;fontscale=contentScale*16;width=viewWidth;scale=viewAspect/contentAspect;left=this.PADDING;top=this.PADDING;height=scale*viewHeight;width=parseInt(width,10);height=parseInt(height,10);var wrapperWidth=width+(this.PADDING*2);var wrapperHeight=height+(this.PADDING*2);this.currentViewMode.container.css({width:wrapperWidth,height:wrapperHeight});this.currentViewMode.wrapper.css({width:width,height:height,position:'absolute','background-color':'#ccc',padding:this.PADDING});this.currentViewMode.wrapperWidth=wrapperWidth;this.currentViewMode.wrapperHeight=wrapperHeight;this.currentViewMode.top=top;this.currentViewMode.left=left;this.currentViewMode.contentScale=contentScale;this.currentViewMode.fontscale=fontscale;this.currentViewMode.width=width;this.currentViewMode.height=height;};SSDocumentSlide.prototype.hide=function(){if(!this.currentViewMode.rendered){return;}
this.empty();delete(this.currentViewMode.contentElement);delete(this.currentViewMode.imageElement);this.currentViewMode.rendered=false;};SSDocumentSlide.prototype.show=function(force){if(this.currentViewMode.rendered&&!force){return;}
this.currentViewMode.rendered=true;this.load();};SSDocumentSlide.prototype.play=function(){$.slideshareEventManager.trigger('slidechanged',{index:this.index});this.show();};SSDocumentSlide.prototype.setContainer=function(config){var mode=config.mode;if(this.viewModes[mode]===undefined){this.viewModes[mode]={'rendered':false,'container':config.container,'wrapper':$('<div/>').appendTo(config.container)};this.viewModes[mode].container.css({position:'relative'});}
this.currentViewMode=this.viewModes[mode];this.currentMode=config.mode;};function SSPresentationDisplayer(config){SSSlideDisplayer.call(this,config);this.zoomLevels=[1];this.prerenderedSlides=[];}
SSPresentationDisplayer.prototype=new SSSlideDisplayer();SSPresentationDisplayer.prototype._bindEvents=function(){};SSPresentationDisplayer.prototype._scrollTo=function(index){if(this.state!=='playing'){return;}
var leftOffset=this.slideOffsets[index];this.slidesContainer.css('margin-left',-1*leftOffset);};SSPresentationDisplayer.prototype.start=function(config){var i,slide;var slideContainers=[];if(this.slides===undefined){this.slides=config.slides;this.state='playing';this.hideInitializer();this.slidesContainer=$('<div/>').attr({'class':'slidesContainer'}).css({position:'relative','background-color':'#ccc'}).appendTo(this.container);for(i=1;i<=this.config.slideCount;i++){slideContainers[i]=$('<div/>').appendTo(this.slidesContainer);}}
for(i=1;i<=this.config.slideCount;i++){slide=this.slides[i];slide.setContainer({mode:config.mode,container:slideContainers[i]});}};SSPresentationDisplayer.prototype.showInitializer=function(){var top,left;top=this.container.height()/2-16;left=this.container.width()/2-16;$('<img/>').attr({src:this.config.spinnerUrl}).css({width:32,height:32,top:top,left:left,position:'absolute'}).appendTo(this.container);};SSPresentationDisplayer.prototype.setDimensions=function(dimensions){var that=this;if(typeof dimensions==='object'){this.config.width=dimensions.width;this.config.height=dimensions.height;}
var partialUpdate=dimensions&&dimensions.partial;this.container.css({height:this.config.height,width:this.config.width});if(!partialUpdate&&this.state==='playing'){this.panelWidth=0;var i,slide,offset;offset=0;for(i=1;i<=this.config.slideCount;i++){slide=this.slides[i];slide.setDimensions({parentHeight:this.config.height,parentWidth:this.config.width});this.slideOffsets[i]=offset;offset+=slide.wrapperOffset();}
this.slidesContainer.width(offset);this.width=offset;}};SSPresentationDisplayer.prototype.setPrerenderedSlides=function(config){var i;this.prerenderedSlides=[];for(i=config.start;i<=config.end;i++){this.prerenderedSlides.push(i);}};function SSPresentationSlide(config){SSSlide.call(this,config);this.PADDING=0;}
SSPresentationSlide.prototype=new SSSlide();SSPresentationSlide.prototype.wrapperOffset=function(){return this.currentViewMode.wrapperWidth;};SSPresentationSlide.prototype.empty=function(){if(typeof this.currentViewMode.wrapper!=='undefined'){this.currentViewMode.wrapper.empty();}};SSPresentationSlide.prototype.displayLoading=function(){var top,left;top=this.currentViewMode.height/2-16;left=this.currentViewMode.width/2-16;this.empty();$('<img/>').attr({src:this.config.spinnerUrl}).css({width:32,height:32,top:top,left:left,position:'absolute'}).appendTo(this.currentViewMode.wrapper);};SSPresentationSlide.prototype.setDimensions=function(dimensions){var origwidth=this.contentWidth;var origheight=this.contentHeight;var contentAspect=origwidth/origheight;var viewWidth=dimensions.parentWidth;var viewHeight=dimensions.parentHeight;var viewAspect=viewWidth/viewHeight;var scale,contentScale,fontscale,width,height;var top,left;if(contentAspect>viewAspect){contentScale=viewWidth/origwidth;fontscale=contentScale*16;width=viewWidth;scale=viewAspect/contentAspect;left=0;top=((1-scale)/2*100)+'%';height=scale*dimensions.parentHeight;}else{contentScale=viewHeight/origheight;fontscale=contentScale*16;scale=contentAspect/viewAspect;top=0;left=((1-scale)/2*100)+'%';width=scale*dimensions.parentWidth;height=viewHeight;}
width=parseInt(width,10);height=parseInt(height,10);var wrapperWidth=viewWidth;var wrapperHeight=viewWidth;this.currentViewMode.container.css({width:viewWidth,height:viewHeight});this.currentViewMode.wrapper.css({width:width,height:height,top:top,left:left,position:'absolute',padding:this.PADDING});this.currentViewMode.wrapperWidth=wrapperWidth;this.currentViewMode.wrapperHeight=wrapperHeight;this.currentViewMode.top=top;this.currentViewMode.left=left;this.currentViewMode.contentScale=contentScale;this.currentViewMode.fontscale=fontscale;this.currentViewMode.width=width;this.currentViewMode.height=height;};SSPresentationSlide.prototype.hide=function(){if(!this.currentViewMode.rendered){return;}
this.empty();delete(this.currentViewMode.contentElement);delete(this.currentViewMode.imageElement);this.currentViewMode.rendered=false;};SSPresentationSlide.prototype.show=function(force){if(this.currentViewMode.rendered&&!force){return;}
this.currentViewMode.rendered=true;this.load();};SSPresentationSlide.prototype.play=function(){};SSPresentationSlide.prototype.setContainer=function(config){var mode=config.mode;if(this.viewModes[mode]===undefined){this.viewModes[mode]={'rendered':false,'container':config.container,'wrapper':$('<div/>').appendTo(config.container)};this.viewModes[mode].container.css({'background-color':'#eee','position':'relative','float':'left'});}
this.currentViewMode=this.viewModes[mode];this.currentMode=config.mode;};function SSPlayerController(config){this.config=config;this.slideCount=this.config.slide_count;this.currentPosition=0;this.loadedSlides=[];this.slideModes={};this.PRELOAD_LOOK_FORWARD_COUNT=2;this.PRELOAD_PRE_LIMIT=2;this.PRELOAD_POST_LIMIT=5;this.FONT_BATCH_COUNT=10;this.DEFAULT_ERROR_SCORE=0;this.AUTOVERIFICATION_ERROR_THRESHOLD=0.001;this.initialized=false;if(config.player_type==='document'){this.PRERENDER_COUNT=1;}else{this.PRERENDER_COUNT=1;}
this._init();this.play(parseInt(this.config.page,10));}
SSPlayerController.prototype._init=function(){window.jsplayerInitTime=new Date();var that=this;$.slideshareEventManager.registerController(this);this.componentSets={};this._createComponentSet('normal');this._bindEvents();this._initFontResources();this.exitFullScreenHandler=this.exitFullScreenHandlerFactory();if(this.config.mode==='html'){this._loadHtmlMetadata();}else{this.postInitialize();}};SSPlayerController.prototype._initFontResources=function(){var suffix;if($.browser.msie){suffix=this.config.html_eotfont_url_suffix;}else{suffix=this.config.html_ttffont_url_suffix;}
var fontBatchNum=Math.ceil(this.slideCount/this.FONT_BATCH_COUNT);var i;this.fontResources=[];for(i=1;i<=fontBatchNum;i++){indexString=this._getIndexString(i,0);this.fontResources[i]={status:'initialized',url:this.config.bucket_location+'meta-'+indexString+suffix+'?'+this.config.timestamp};}};SSPlayerController.prototype._loadHtmlMetadata=function(){this.metaResource=new SSMetaResource({url:this.config.bucket_location+'meta.js',timestamp:this.config.timestamp,type:'html'});this.metaResource.load();};SSPlayerController.prototype._loadImageMetadata=function(isFallback){this.imageMetaResource=new SSMetaResource({url:this.config.image_bucket_location+'.js',timestamp:this.config.timestamp,type:isFallback?'imagefallback':'imageprimary'});this.imageMetaResource.load();};SSPlayerController.prototype._metaDataHandlers=function(){return{html:{success:function(data){this.slideSizes=data.sizes;this.imageFormats=data.image_formats;try{this.errorScores=data.error_scores.webkit;}catch(exception){this.errorScores={};}
var commonStyle="<style>a.ssml_a {text-decoration:none;color:inherit;vertical-align:top;} "+"\n.ssml_div span {position:absolute; white-space:pre; vertical-align:top; line-height:normal;} "+"\n.ssml_div div {position:absolute;line-height:normal;}\n.ssml_div{font-size:16px;}</style>";$(commonStyle).appendTo(this.currentComponentSet.container);this.postInitialize();},failure:function(){this.currentComponentSet.slidedisplayer.error();}},imagefallback:{success:function(data){var imageSizes=data.sizes||{};var i,slideIndex;var imageCount=this.slideModes.image.length;for(i=0;i<imageCount;i++){slideIndex=this.slideModes.image[i];if(imageSizes[slideIndex]!==undefined){this.slides[slideIndex].updateResource('image',{newSize:imageSizes[slideIndex]});}}
this._repaintPrerenderedSlides();},failure:function(){}},imageprimary:{success:function(data){$(that).trigger('metadataloaded');},failure:function(){$(that).trigger('metadataloadfailed');}}};};SSPlayerController.prototype.postInitialize=function(){this._initSlides();this._activateComponentSet('normal');this._setModeForSlides('normal');this.setDimensions();$(this).trigger('playerinitialized');};SSPlayerController.prototype._bindEvents=function(){var that=this;$(this).bind('playerinitialized',function(){this.initialized=true;that.play();});if(!(this.config.touch||this.config.player_type==='document')){$(document).bind('keyup',function(e){if(e.keyCode===37){$.slideshareEventManager.trigger('previous');}
if(e.keyCode===39){$.slideshareEventManager.trigger('next');}});}};SSPlayerController.prototype._bindComponentSetEvents=function(){var that=this;var componentSet=this.currentComponentSet;$(componentSet.slidedisplayer).bind('zoomchanged',function(e){that.repaint();});};SSPlayerController.prototype._createComponentSet=function(mode){var that=this;this.componentSets[mode]={};this.currentComponentSet=this.componentSets[mode];this.currentViewMode=mode;var componentSet=this.currentComponentSet;if(mode==='normal'){componentSet.container=$('#'+this.config.container);if(componentSet.container.length!==1){throw'Unable to find container for player';}}else if(mode==='fullscreen'){componentSet.container=$('<div/>').css({'height':'100%','left':0,'position':'absolute','top':0,'width':'100%','z-index':10050}).appendTo($('body'));$('body').css({'overflow':'hidden'});$(window).scrollTop(0);}
componentSet.navigators=[];var displayerConfig={renderTo:componentSet.container,spinnerUrl:this.config.spinner_url,errorImageUrl:this.config.error_image_url,mode:this.config.mode,slideCount:this.slideCount,playerType:this.config.player_type};if(this.config.player_type==='document'){componentSet.slidedisplayer=new SSDocumentDisplayer(displayerConfig);}else{componentSet.slidedisplayer=new SSPresentationDisplayer(displayerConfig);}
componentSet.navigators.push(componentSet.slidedisplayer);this.hasToolbar=!this.config.touch;this.setDimensions();if(this.config.touch){componentSet.touchInteraction=new SSTouchInteraction({container:componentSet.slidedisplayer.container});componentSet.navigators.push(componentSet.touchInteraction);}else if(this.config.player_type!=='document'){componentSet.bandInteraction=new SSBandInteraction({container:componentSet.slidedisplayer.container,width:componentSet.width});componentSet.navigators.push(componentSet.bandInteraction);}
if(this.hasToolbar){componentSet.toolbar=new SSToolbar({width:componentSet.width,height:componentSet.toolbarHeight,html:this.config.toolbar_html,renderTo:componentSet.container,slideCount:this.slideCount,primaryResourceType:this.config.primaryResourceType,disableShare:this.config.disable_share,enableViewSS:this.config.enable_viewSS,isFullScreen:(mode==='fullscreen')||this.config.is_fullscreen,playerType:this.config.player_type});componentSet.navigators.push(componentSet.toolbar);}
this._bindComponentSetEvents();};SSPlayerController.prototype._destroyComponentSet=function(mode){var componentSet=this.componentSets[mode];$.each(componentSet.navigators,function(i,navigatorItem){navigatorItem.destroy();});delete(this.componentSets[mode].navigators);delete(this.componentSets[mode].slidedisplayer);if(mode==='fullscreen'){componentSet.container.remove();$('body').css({'overflow':'auto'});}
var slide;for(var i=1;i<=this.slideCount;i++){slide=this.slides[i];slide.viewModes[mode].container.remove();delete(slide.viewModes[mode]);}
delete(this.componentSets[mode].container);delete(this.componentSets[mode]);};SSPlayerController.prototype._initSlides=function(){this.slides=[];this.slideModes.html=[];this.slideModes.image=[];var i,slide,size,slideConfig,midImageFormats,errorScore,slideMode;var imageMetaRequired=false;for(i=1;i<=this.slideCount;i++){size=this.slideSizes[i];if(!this.config.image_ready){slideMode='html';}else{errorScore=parseFloat(this.errorScores[i]);if(isNaN(errorScore)){errorScore=this.DEFAULT_ERROR_SCORE;}
if(errorScore>this.AUTOVERIFICATION_ERROR_THRESHOLD){slideMode='image';imageMetaRequired=true;}else{slideMode='html';}}
switch(slideMode){case'html':this.slideModes.html.push(i);break;case'image':this.slideModes.image.push(i);break;}
bgImageFormats=this.imageFormats[i]||{};slideConfig={index:i,type:this.config.mode,slideMode:slideMode,bucketLocation:this.config.bucket_location,imageBucketLocation:this.config.image_bucket_location,indexGenerator:this._getIndexString,contentWidth:size.width,contentHeight:size.height,bgImageFormats:bgImageFormats,playerWidth:this.currentComponentSet.width,errorImageUrl:this.config.error_image_url,spinnerUrl:this.config.spinner_url,playerType:this.config.player_type,stripped_title:this.config.stripped_title,timestamp:this.config.timestamp};if(this.config.player_type==='document'){slide=new SSDocumentSlide(slideConfig);}else{slide=new SSPresentationSlide(slideConfig);}
this.slides[i]=slide;}
if(imageMetaRequired===true){this._loadImageMetadata(true);}};SSPlayerController.prototype._getIndexString=function(number,length){var s=''+number;var numberlen=s.length;var i;for(i=0;i<(length-numberlen);i++){s='0'+s;}
return s;};SSPlayerController.prototype._getContainerSize=function(){this.currentComponentSet.width=this.currentComponentSet.container.width();this.currentComponentSet.height=this.currentComponentSet.container.height();};SSPlayerController.prototype.setDimensions=function(partial){var componentSet=this.currentComponentSet;this._getContainerSize();partial=partial||false;componentSet.toolbarHeight=30;componentSet.toolbarHeightPadding=8;if(this.hasToolbar){componentSet.viewHeight=componentSet.height-componentSet.toolbarHeight-componentSet.toolbarHeightPadding;}else{componentSet.viewHeight=componentSet.height;}
componentSet.slidedisplayer.setDimensions({width:componentSet.width,height:componentSet.viewHeight,partial:partial});if(!partial){var dimensions={height:componentSet.height,width:componentSet.width};if(this.currentComponentSet.toolbar!==undefined){this.currentComponentSet.toolbar.setDimensions(dimensions);}
if(this.currentComponentSet.shareScreen!==undefined){this.currentComponentSet.shareScreen.setDimensions(dimensions);}
if(this.currentComponentSet.lastScreen!==undefined){this.currentComponentSet.lastScreen.setDimensions(dimensions);}}};SSPlayerController.prototype.repaint=function(){if(this.currentComponentSet.slidedisplayer===undefined){return;}
this.setDimensions(true);this.setDimensions();this._repaintPrerenderedSlides();this.currentComponentSet.slidedisplayer._scrollTo(this.currentPosition);};SSPlayerController.prototype._repaintPrerenderedSlides=function(){var prerenderedSlides=this.currentComponentSet.slidedisplayer.prerenderedSlides;var slideIndex;if(prerenderedSlides.length>0){var i;for(i=0;i<prerenderedSlides.length;i++){slideIndex=prerenderedSlides[i];this.slides[slideIndex].show(true);}}};SSPlayerController.prototype.updateCurrentPosition=function(position){if(typeof this.currentComponentSet.toolbar!=='undefined'){this.currentComponentSet.toolbar.updateCurrentPosition(position);}
this.currentPosition=position;};SSPlayerController.prototype.displayLastScreen=function(){var that=this;if(typeof this.currentComponentSet.lastScreen==='undefined'){if(this.config.disable_lastscreen){this.currentComponentSet.lastScreen=new SSReplayScreen({renderTo:this.currentComponentSet.container,settings:this.config.replayscreen});}else{this.currentComponentSet.lastScreen=new SSLastScreen({renderTo:this.currentComponentSet.container,settings:this.config.lastscreen});}
$(this.currentComponentSet.lastScreen).bind('gotofirstslide',function(){$(that).trigger('gotofirstslide');});$(this.currentComponentSet.lastScreen).bind('showshareoptions',function(){that.displayShareScreen();});}
this.currentComponentSet.lastScreen.show({width:this.currentComponentSet.width,height:this.currentComponentSet.height});};SSPlayerController.prototype.displayShareScreen=function(){var that=this;if(typeof this.currentComponentSet.shareScreen==='undefined'){this.currentComponentSet.shareScreen=new SSShareScreen({renderTo:this.currentComponentSet.container,settings:this.config.sharescreen});}
this.currentComponentSet.shareScreen.show({width:this.currentComponentSet.width,height:this.currentComponentSet.height});};SSPlayerController.prototype.loadFonts=function(batchIndex){var i=batchIndex;if(this.fontResources[batchIndex].status==='initialized'){this.fontResources[batchIndex].status='loading';$.jsonp({url:this.fontResources[batchIndex].url,callback:'slideshare_jsonp_font_hook_trigger',success:(function(index,controller){return function(data){controller.fontResources[index].status='cached';var styleData='<style>'+data.style+'</style>';$(styleData).appendTo(controller.componentSets.normal.container);};})(batchIndex,this),error:(function(index){return function(){};})(batchIndex),cache:true,timeout:10000});}};SSPlayerController.prototype._load=function(anchorIndex){anchorIndex=anchorIndex||1;var i,slide;var that=this;this.loadFonts(Math.ceil(anchorIndex/this.FONT_BATCH_COUNT));var startPrerender=anchorIndex-this.PRERENDER_COUNT;if(startPrerender<1){startPrerender=1;}
var endPrerender=anchorIndex+this.PRERENDER_COUNT;if(endPrerender>this.slideCount){endPrerender=this.slideCount;}
for(i=startPrerender;i<=endPrerender;i++){this.slides[i].show();this.loadedSlides[i]=true;}
if($.browser.msie){var prerenderedSlides=this.currentComponentSet.slidedisplayer.prerenderedSlides;var slideIndex;for(i=0;i<prerenderedSlides.length;i++){slideIndex=prerenderedSlides[i];if(slideIndex<startPrerender||slideIndex>endPrerender){slide=this.slides[slideIndex];slide.hide();}}}
this.currentComponentSet.slidedisplayer.setPrerenderedSlides({start:startPrerender,end:endPrerender});clearTimeout(this.preloadTimeoutId);this.preloadTimeoutId=setTimeout(function(){var slideCount=that.PRELOAD_PRE_LIMIT+that.PRELOAD_POST_LIMIT+1;var startSlideIndex=anchorIndex-that.PRELOAD_PRE_LIMIT;if(startSlideIndex<1){startSlideIndex=1;}
var endSlideIndex=startSlideIndex+slideCount-1;if(endSlideIndex>that.slideCount){endSlideIndex=that.slideCount;}
var lookforwardLimit=anchorIndex+that.PRELOAD_LOOK_FORWARD_COUNT;if(lookforwardLimit>that.slideCount){lookforwardLimit=that.slideCount;}
startFontBatch=Math.ceil(startSlideIndex/that.FONT_BATCH_COUNT);endFontBatch=Math.ceil(endSlideIndex/that.FONT_BATCH_COUNT);for(i=startFontBatch;i<=endFontBatch;i++){that.loadFonts(i);}
for(i=startSlideIndex;i<=endSlideIndex;i++){if(!that.loadedSlides[i]){slide=that.slides[i];slide.load();that.loadedSlides[i]=true;}}},2000);};SSPlayerController.prototype.play=function(index,force){if(!this.initialized){this.playQueue=index||1;return;}
if(index===undefined){if(typeof this.playQueue!=='undefined'){index=this.playQueue;delete(this.playQueue);}else{index=1;}}
if(index<1){index=1;}
if(index>this.slideCount){index=this.slideCount;}
if(this.currentPosition===index&&!force){return;}
$.slideshareEventManager.trigger('slidechanged',{index:index,force:force});};SSPlayerController.prototype.switchView=function(mode){if(mode===this.currentViewMode){return;}
this._deactivateComponentSet(this.currentViewMode);if(this.componentSets[mode]===undefined){this._createComponentSet(mode);}
this._activateComponentSet(mode);this._setModeForSlides(mode);this.setDimensions();this.play(this.currentPosition,true);this._load(this.currentPosition);this.updateCurrentPosition(this.currentPosition);};SSPlayerController.prototype._activateComponentSet=function(mode){var componentSet=this.componentSets[mode];var navigators=componentSet.navigators;$.each(navigators,function(index,navigatorItem){navigatorItem.activate();});if(mode==='fullscreen'||this.config.is_fullscreen){$(document).bind('keyup',this.exitFullScreenHandler);}else{$(document).unbind('keyup',this.exitFullScreenHandler);}
this.currentComponentSet=componentSet;this.currentViewMode=mode;};SSPlayerController.prototype.exitFullScreenHandlerFactory=function(){var that=this;return function(e){if(e.keyCode===27){try{$.slideshareEventManager.trigger('viewfullscreen');}catch(exception){}}};};SSPlayerController.prototype._deactivateComponentSet=function(mode){var componentSet=this.componentSets[mode];var navigators=componentSet.navigators;$.each(navigators,function(index,navigatorItem){navigatorItem.deactivate();});if(mode==='fullscreen'){this._destroyComponentSet('fullscreen');}
this.currentComponentSet=null;this.currentViewMode=null;};SSPlayerController.prototype._setModeForSlides=function(mode){this.currentComponentSet.slidedisplayer.start({slides:this.slides,mode:mode});this.currentComponentSet.slidedisplayer._bindEvents();};SSPlayerController.prototype.getFullScreenUrl=function(){return this.config.fullscreen_url+'/'+this.currentPosition;};;window.Modernizr=function(a,b,c){function z(a,b){for(var d in a)if(j[a[d]]!==c)return b=="pfx"?a[d]:!0;return!1}function y(a,b){return!!~(""+a).indexOf(b)}function x(a,b){return typeof a===b}function w(a,b){return v(m.join(a+";")+(b||""))}function v(a){j.cssText=a}var d="2.0.6",e={},f=b.documentElement,g=b.head||b.getElementsByTagName("head")[0],h="modernizr",i=b.createElement(h),j=i.style,k,l=Object.prototype.toString,m=" -webkit- -moz- -o- -ms- -khtml- ".split(" "),n={},o={},p={},q=[],r=function(a,c,d,e){var g,i,j,k=b.createElement("div");if(parseInt(d,10))while(d--)j=b.createElement("div"),j.id=e?e[d]:h+(d+1),k.appendChild(j);g=["&shy;","<style>",a,"</style>"].join(""),k.id=h,k.innerHTML+=g,f.appendChild(k),i=c(k,a),k.parentNode.removeChild(k);return!!i},s,t={}.hasOwnProperty,u;!x(t,c)&&!x(t.call,c)?u=function(a,b){return t.call(a,b)}:u=function(a,b){return b in a&&x(a.constructor.prototype[b],c)};var A=function(c,d){var f=c.join(""),g=d.length;r(f,function(c,d){var f=b.styleSheets[b.styleSheets.length-1],h=f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"",i=c.childNodes,j={};while(g--)j[i[g].id]=i[g];e.touch="ontouchstart"in a||j.touch.offsetTop===9},g,d)}([,["@media (",m.join("touch-enabled),("),h,")","{#touch{top:9px;position:absolute}}"].join("")],[,"touch"]);n.touch=function(){return e.touch},n.csstransforms=function(){return!!z(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"])};for(var B in n)u(n,B)&&(s=B.toLowerCase(),e[s]=n[B](),q.push((e[s]?"":"no-")+s));v(""),i=k=null,e._version=d,e._prefixes=m,e.testProp=function(a){return z([a])},e.testStyles=r;return e}(this,this.document);function SSPlayer(config){this.config=config;this._init();};SSPlayer.prototype._init=function(){this.config.touch=Modernizr.touch;this.controller=new SSPlayerController(this.config);$.slideshareEventManager.registerPlayer(this);var that=this;$(window).bind('resize',function(){$.slideshareEventManager.trigger('repaint');});};SSPlayer.prototype.play=function(index){index=index||1;this.controller.play(index);};SSPlayer.prototype.gotoCurrent=function(){this.controller.play(this.controller.currentPosition,true);};