<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><title>Peggy:&nbsp; 新しい時代のパーザジェネレータ</title><meta charset="utf-8"><script src="haskell-bnk-peggy-2011-12-16_files/slides.txt"></script><link rel="stylesheet" href="haskell-bnk-peggy-2011-12-16_files/syntax.css"><link rel="stylesheet" href="haskell-bnk-peggy-2011-12-16_files/style.css"><meta content="width=1100,height=750" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"></head><body class="loaded" style="display: none;"><section class="slides layout-regular template-pfi"><article class=""><h1>Peggy:&nbsp;<br>新しい時代のパーザジェネレータ</h1><p>田中英行&nbsp;<a href="mailto:tanaka.hideyuki@gmail.com" alt="">tanaka.hideyuki@gmail.com</a><br>2011-12-16&nbsp;@&nbsp;Haskell忘年会</p></article><article class=""><h3>自己紹介</h3><ul><li>田中英行&nbsp;(@tanakh,&nbsp;<a href="http://tanakh.jp/" alt="">http://tanakh.jp</a>)</li><li>(株)Preferred&nbsp;Infrastructure&nbsp;勤務<ul><li>C++&nbsp;書いてます</li></ul></li><li>Haskell愛好家&nbsp;(2004～)</li><li>Learn&nbsp;You&nbsp;a&nbsp;Haskell&nbsp;for&nbsp;Great&nbsp;Good!&nbsp;翻訳中<ul><li>来春予定</li></ul></li><li>C81関数型イカ娘本寄稿予定<ul><li>SS2篇</li></ul></li></ul><div style="position:absolute; top:350px; left:600px;"><img src="haskell-bnk-peggy-2011-12-16_files/d6add_.jpg" width="240px"></div>
</article><article class=""><h2>Peggy:&nbsp;全く新しいパーザジェネレータ</h2></article><article class=""><h3>Peggyとは？</h3><ul><li>パーザジェネレータのモダンな実装<ul><li>新しい構文解析アルゴリズム</li><li>シンプル・簡単・強力な記法</li></ul></li><li>Quasi-Quoterである<ul><li>Haskellコードへのシームレスな組み込み</li><li>Standalone&nbsp;なパーザとしても利用可能</li></ul></li><li>Quasi-Quoter生成機能<ul><li>Haskellコードのシームレスな生成</li></ul></li><li>Unquoter生成機能<ul><li>Haskellコードとシームレスにインタラクション</li></ul></li></ul></article><article class=""><h3>Why&nbsp;Peggy?</h3><ul><li>典型的なボトムアップパーザはフラストトレーティング<ul><li>コンフリクト</li><li>構文</li><li>表現力&nbsp;(Scanner,&nbsp;Parserそれぞれ)</li><li>貧弱なエラーメッセージ</li></ul></li><li>HaskellにおけるQuasiQuoter機運の高まり<ul><li>実用例増えてきた&nbsp;(なんとか-qq&nbsp;パッケージがたくさん)</li><li>しかし、TemplateHaskellのコードを書くのは大変</li><li>Unquoteをサポートさせると更に大変…</li></ul></li><li>そこでPeggy！</li></ul></article><article class=""><h3>既存研究</h3><ul><li>Yacc<ul><li>LALR(1)</li></ul></li><li>Bison<ul><li>LALR(1)&nbsp;/&nbsp;GLR</li></ul></li><li>ANTLR&nbsp;/&nbsp;JavaCC<ul><li>LL(k)</li></ul></li><li>Parsec<ul><li>LL(1|k)</li></ul></li></ul></article><article class=""><h3>PEG(Parsing&nbsp;Expression&nbsp;Grammer：解析表現文法)&nbsp;とは</h3><ul><li><p>形式言語の文法表現の一つ</p></li><li><p>CFGに似ているが、CFGとは違う</p></li><li>比較的最近定式化された&nbsp;[Ford&nbsp;2002,&nbsp;2004]<ul><li>トップダウンパージングの拡張</li></ul></li></ul><p><img src="haskell-bnk-peggy-2011-12-16_files/peg.png" alt="" class="centered"></p></article><article class="far-past"><h3>PEGの利点</h3><ul><li>曖昧さがない<ul><li>Shift/Reduce&nbsp;コンフリクトがない</li></ul></li><li>無限の先読みが可能<ul><li>CFGで表せないものも表現できる</li><li>(CFG&nbsp;⊂&nbsp;PEG)&nbsp;かどうかは未解決</li></ul></li><li>Scanner&nbsp;を分けて書く必要がない<ul><li>記述がシンプルに</li></ul></li><li>(先読みを許しつつ)入力長の線形時間でパーズ可能<ul><li>しかもアルゴリズムがシンプル</li></ul></li></ul></article><article class="past"><h3>PEGの欠点</h3><ul><li>歴史が浅く、利用例が少ない<ul><li>LALR構文解析は非常に歴史がある</li></ul></li><li>表現可能な言語の範囲が未解決<ul><li>例：回文はPEGか否か</li></ul></li></ul></article><article class="current"><h3>Packrat&nbsp;Parser</h3><ul><li>PEGを線形時間で解析するアルゴリズム<ul><li>DPによるアルゴリズム</li><li>詳細は別ページに譲ります</li></ul></li><li>Packrat&nbsp;Parsing:&nbsp;a&nbsp;Practical&nbsp;Linear&nbsp;-&nbsp;<br>&nbsp;Time&nbsp;Algorithm&nbsp;with&nbsp;Backtracking<ul><li><a href="http://pdos.csail.mit.edu/%7Ebaford/packrat/thesis/" alt="">http://pdos.csail.mit.edu/~baford/packrat/thesis/</a></li></ul></li></ul></article><article class="next"><h2>Peggy入門</h2></article><article class="far-next"><h3>文法概要</h3><ul><li>パーザ定義の列<ul><li>すべての非終端記号が各々型を持ったパーザになる</li></ul></li></ul>
<pre class="noprettyprint sourceCode"><code class="sourceCode haskell"><span class="co"><span class="pun">--</span><span class="pln"> </span><span class="typ">Peggy</span><span class="pln"> </span><span class="typ">QuasiQuoter</span></span><br><span class="pun">[</span><span class="pln">peggy</span><span class="fu"><span class="pun">|</span></span><br><span class="ot"><span class="pln">parens </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">Int</span></span><span class="pln">                 </span><span class="co"><span class="pun">--</span><span class="pln"> </span><span class="pun">パーザの型</span></span><br><span class="pln">  </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="st"><span class="str">"("</span></span><span class="pln"> parens </span><span class="st"><span class="str">")"</span></span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="dv"><span class="pln">1</span></span><span class="pln"> </span><span class="fu"><span class="pun">+</span></span><span class="pln"> </span><span class="dv"><span class="lit">1</span></span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="co"><span class="pun">--</span><span class="pln"> </span><span class="pun">定義</span></span><br><span class="pln">  </span><span class="fu"><span class="pun">/</span></span><span class="pln"> </span><span class="st"><span class="str">""</span></span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="dv"><span class="lit">0</span></span><span class="pln"> </span><span class="pun">}</span><br><br><span class="ot"><span class="pln">hoge </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">String</span></span><span class="pln"> </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="st"><span class="str">"aiueo"</span></span><span class="pln">      </span><span class="co"><span class="pun">--</span><span class="pln"> </span><span class="pun">空白・改行は意味を持たない</span></span><br><br><span class="ot"><span class="pln">foo </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="pun">()</span><br><span class="pln">  </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="pun">(</span><span class="st"><span class="str">"abc"</span></span><span class="pln"> </span><span class="fu"><span class="pun">/</span></span><span class="pln"> </span><span class="st"><span class="str">"def"</span></span><span class="pun">)</span><span class="pln"> </span><span class="st"><span class="str">"ghi"</span></span><span class="pln">     </span><span class="co"><span class="pun">--</span><span class="pln"> </span><span class="pun">任意の式を括弧で囲える</span></span><br><span class="fu"><span class="pun">|</span></span><span class="pun">]</span><br><br><span class="co"><span class="pun">--</span><span class="pln"> main routine</span></span><br><span class="ot"><span class="pln">main </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="pln">IO</span></span><span class="pln"> </span><span class="pun">()</span><br><span class="pln">main </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="fu"><span class="kwd">print</span></span><span class="pln"> </span><span class="fu"><span class="pun">.</span></span><span class="pln"> parseString parens </span><span class="st"><span class="str">"&lt;stdin&gt;"</span></span><span class="pln"> </span><span class="fu"><span class="pun">=&lt;&lt;</span></span><span class="pln"> </span><span class="fu"><span class="pln">getContents</span></span></code></pre>
</article><article><h3>構文一通り&nbsp;(1)</h3><ul><li>文字クラス</li></ul>
<pre class="noprettyprint sourceCode"><code class="sourceCode haskell"><span class="ot"><span class="pln">identChar </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">Char</span></span><span class="pln"> </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="pun">[</span><span class="pln">_a</span><span class="fu"><span class="pun">-</span></span><span class="pln">zA</span><span class="fu"><span class="pun">-</span></span><span class="dt"><span class="pln">Z0</span></span><span class="fu"><span class="pun">-</span></span><span class="dv"><span class="lit">9</span></span><span class="pun">]</span></code></pre>
<ul><li>繰り返し</li></ul>
<pre class="noprettyprint sourceCode"><code class="sourceCode haskell"><span class="ot"><span class="pln">ident0 </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">String</span></span><span class="pln"> </span><span class="fu"><span class="pun">=</span></span><span class="pln"> identChar</span><span class="fu"><span class="pun">*</span></span><br><span class="ot"><span class="pln">ident1 </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">String</span></span><span class="pln"> </span><span class="fu"><span class="pun">=</span></span><span class="pln"> identChar</span><span class="fu"><span class="pun">+</span></span></code></pre>
</article><article><h3>構文一通り&nbsp;(2)</h3><ul><li>オプショナル</li></ul>
<pre class="noprettyprint sourceCode"><code class="sourceCode haskell"><span class="ot"><span class="pln">mbident </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">Maybe</span></span><span class="pln"> </span><span class="dt"><span class="typ">String</span></span><span class="pln"> </span><span class="fu"><span class="pun">=</span></span><span class="pln"> ident</span><span class="fu"><span class="pun">?</span></span></code></pre>
<ul><li>セマンティクス注釈</li></ul>
<pre class="noprettyprint sourceCode"><code class="sourceCode haskell"><span class="ot"><span class="pln">number </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">Int</span></span><span class="pln"> </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="pun">[</span><span class="dv"><span class="lit">0</span></span><span class="fu"><span class="pun">-</span></span><span class="dv"><span class="lit">9</span></span><span class="pun">]</span><span class="fu"><span class="pun">+</span></span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="fu"><span class="pln">read</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="dv"><span class="pln">1</span></span><span class="pln"> </span><span class="pun">}</span></code></pre>
</article><article><h3>構文一通り&nbsp;(3)</h3><ul><li>Predicate</li></ul>
<pre class="noprettyprint sourceCode"><code class="sourceCode haskell"><span class="ot"><span class="pln">foo </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">String</span></span><span class="pln"> </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="fu"><span class="pun">!</span></span><span class="pln">number ident </span><span class="co"><span class="pun">--</span><span class="pln"> </span><span class="pun">否定</span></span><br><span class="ot"><span class="pln">bar </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">String</span></span><span class="pln"> </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="fu"><span class="pun">&amp;</span></span><span class="pln">ident ident  </span><span class="co"><span class="pun">--</span><span class="pln"> </span><span class="pun">肯定</span></span></code></pre>
</article><article><h3>使いやすさのための工夫(1)</h3><ul><li>右再帰の除去<ul><li>PEGでは、LL構文解析と同様、右再帰が許されない</li><li>Peggyでは、利便性のために自動右再帰除去を実装<ul><li>間接右再帰は未サポートです&nbsp;(’&gt;_&lt;`)</li></ul></li></ul></li><li>トークンのサポート<ul><li>Scannerが無いため、字句の区切りの処理が面倒<ul><li>例：&nbsp;inta;&nbsp;//&nbsp;&lt;-&nbsp;こういうのを許さないようにしたい</li></ul></li><li>デリミタのカスタマイズ</li></ul></li><li>空白文字のカスタマイズ<ul><li>空白文字として任意のパーザを指定できる<ul><li>C言語スタイルのコメント読み飛ばしなど</li></ul></li></ul></li><li>ソースロケーションを簡単に挿入する機能</li></ul></article><article><h3>使いやすさのための工夫(2)</h3><ul><li>値がついて欲しいところだけ値がつく</li></ul>
<pre class="noprettyprint sourceCode"><code class="sourceCode haskell"><span class="ot"><span class="pln">forStmt </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">Stmt</span></span><br><span class="pln">  </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="st"><span class="str">"for"</span></span><span class="pln"> </span><span class="st"><span class="str">"("</span></span><span class="pln"> expr</span><span class="fu"><span class="pun">?</span></span><span class="pln"> </span><span class="st"><span class="str">";"</span></span><span class="pln"> expr</span><span class="fu"><span class="pun">?</span></span><span class="pln"> </span><span class="st"><span class="str">";"</span></span><span class="pln"> expr</span><span class="fu"><span class="pun">?</span></span><span class="pln"> </span><span class="st"><span class="str">")"</span></span><span class="pln"> stmt</span><br><span class="pln">    </span><span class="pun">{</span><span class="pln"> </span><span class="dt"><span class="typ">ForStmt</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="dv"><span class="pln">1</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="dv"><span class="pln">2</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="dv"><span class="pln">3</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="dv"><span class="pln">4</span></span><span class="pln"> </span><span class="pun">}</span></code></pre>
<ul><li>名前へのバインド</li></ul>
<pre class="noprettyprint sourceCode"><code class="sourceCode haskell"><span class="ot"><span class="pln">forStmt </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">Stmt</span></span><br><span class="pln">  </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="st"><span class="str">"for"</span></span><span class="pln"> </span><span class="st"><span class="str">"("</span></span><span class="pln"> </span><span class="fu"><span class="pln">init</span></span><span class="fu"><span class="pun">:</span></span><span class="pln">expr</span><span class="fu"><span class="pun">?</span></span><span class="pln"> </span><span class="st"><span class="str">";"</span></span><span class="pln"> cond</span><span class="fu"><span class="pun">:</span></span><span class="pln">expr</span><span class="fu"><span class="pun">?</span></span><span class="pln"> </span><span class="st"><span class="str">";"</span></span><span class="pln"> post</span><span class="fu"><span class="pun">:</span></span><span class="pln">expr</span><span class="fu"><span class="pun">?</span></span><span class="pln"> </span><span class="st"><span class="str">")"</span></span><span class="pln"> </span><span class="st"><span class="str">"{"</span></span><span class="pln"> body</span><span class="fu"><span class="pun">:</span></span><span class="pln">stmt</span><span class="fu"><span class="pun">*</span></span><span class="pln"> </span><span class="st"><span class="str">"}"</span></span><br><span class="pln">        </span><span class="pun">{</span><span class="pln"> </span><span class="dt"><span class="typ">ForStmt</span></span><span class="pln"> </span><span class="fu"><span class="pln">init</span></span><span class="pln"> cond post body </span><span class="pun">}</span></code></pre>
</article><article><h3>使いやすさのための工夫(3)</h3><ul><li>PEGに対する構文拡張<ul><li>セパレータ付き繰り返し</li><li>Haskellの式によるPredicate</li></ul></li></ul>
<pre class="noprettyprint sourceCode"><code class="sourceCode haskell"><span class="ot"><span class="pln">args </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="pun">[</span><span class="dt"><span class="typ">Expr</span></span><span class="pun">]</span><br><span class="pln">  </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="pun">(</span><span class="pln">expr</span><span class="pun">,</span><span class="pln"> </span><span class="st"><span class="str">","</span></span><span class="pun">)</span><span class="pln"> </span><span class="co"><span class="pun">--</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">回以上</span></span><br><span class="ot"><span class="pln">args1 </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="pun">[</span><span class="dt"><span class="typ">Expr</span></span><span class="pun">]</span><br><span class="pln">  </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="pun">(</span><span class="pln">expr</span><span class="pun">;</span><span class="pln"> </span><span class="st"><span class="str">","</span></span><span class="pun">)</span><span class="pln"> </span><span class="co"><span class="pun">--</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">回以上</span></span></code></pre>
</article><article><h3>トークン仕様</h3><ul><li>連続したアルファベットまたは数字</li><li>連続した記号<ul><li>デリミタでの終端は許される</li></ul></li></ul></article><article><h3>構文糖衣</h3><ul><li>ダブルクオートで囲われた文字列はトークン、&nbsp;シングルクオートは単なる文字列</li></ul>
<pre class="noprettyprint sourceCode"><code class="sourceCode haskell"><span class="ot"><span class="pln">token </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">String</span></span><span class="pln"> </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="st"><span class="str">"hoge"</span></span><span class="pln"> </span><span class="co"><span class="pun">--</span><span class="pln"> </span><span class="pun">トークン</span></span></code></pre>
<ul><li>hoge&nbsp;:::&nbsp;type&nbsp;と書くとトークンになる</li></ul>
<pre class="noprettyprint sourceCode"><code class="sourceCode haskell"><span class="pln">number </span><span class="ot"><span class="pun">::</span></span><span class="fu"><span class="pun">:</span></span><span class="pln"> </span><span class="dt"><span class="typ">Int</span></span><br><span class="pln">  </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="pun">[</span><span class="dv"><span class="lit">0</span></span><span class="fu"><span class="pun">-</span></span><span class="dv"><span class="lit">9</span></span><span class="pun">]</span><span class="fu"><span class="pun">+</span></span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="fu"><span class="pln">read</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="dv"><span class="pln">1</span></span><span class="pln"> </span><span class="pun">}</span></code></pre>
</article><article><h2>実際の例</h2></article><article><h3>四則演算</h3>
<pre class="noprettyprint sourceCode"><code class="sourceCode haskell"><span class="fu"><span class="pln">exp</span></span><span class="ot"><span class="pln"> </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">Double</span></span><br><span class="pln">  </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="fu"><span class="pln">exp</span></span><span class="pln"> </span><span class="st"><span class="str">"+"</span></span><span class="pln"> fact  </span><span class="pun">{</span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="dv"><span class="pln">1</span></span><span class="pln"> </span><span class="fu"><span class="pun">+</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="dv"><span class="pln">2</span></span><span class="pln"> </span><span class="pun">}</span><br><span class="pln">  </span><span class="fu"><span class="pun">/</span></span><span class="pln"> </span><span class="fu"><span class="pln">exp</span></span><span class="pln"> </span><span class="st"><span class="str">"-"</span></span><span class="pln"> fact  </span><span class="pun">{</span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="dv"><span class="pln">1</span></span><span class="pln"> </span><span class="fu"><span class="pun">-</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="dv"><span class="pln">2</span></span><span class="pln"> </span><span class="pun">}</span><br><span class="pln">  </span><span class="fu"><span class="pun">/</span></span><span class="pln"> fact</span><br><span class="ot"><span class="pln">fact </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">Double</span></span><br><span class="pln">  </span><span class="fu"><span class="pun">=</span></span><span class="pln"> fact </span><span class="st"><span class="str">"*"</span></span><span class="pln"> term </span><span class="pun">{</span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="dv"><span class="pln">1</span></span><span class="pln"> </span><span class="fu"><span class="pun">*</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="dv"><span class="pln">2</span></span><span class="pln"> </span><span class="pun">}</span><br><span class="pln">  </span><span class="fu"><span class="pun">/</span></span><span class="pln"> fact </span><span class="st"><span class="str">"/"</span></span><span class="pln"> term </span><span class="pun">{</span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="dv"><span class="pln">1</span></span><span class="pln"> </span><span class="fu"><span class="pun">/</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="dv"><span class="pln">2</span></span><span class="pln"> </span><span class="pun">}</span><br><span class="pln">  </span><span class="fu"><span class="pun">/</span></span><span class="pln"> term</span><br><span class="ot"><span class="pln">term </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">Double</span></span><br><span class="pln">  </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="st"><span class="str">"("</span></span><span class="pln"> </span><span class="fu"><span class="pln">exp</span></span><span class="pln"> </span><span class="st"><span class="str">")"</span></span><br><span class="pln">  </span><span class="fu"><span class="pun">/</span></span><span class="pln"> number</span><br><span class="pln">number </span><span class="ot"><span class="pun">::</span></span><span class="fu"><span class="pun">:</span></span><span class="pln"> </span><span class="dt"><span class="typ">Double</span></span><br><span class="pln">  </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="pun">([</span><span class="dv"><span class="lit">1</span></span><span class="fu"><span class="pun">-</span></span><span class="dv"><span class="lit">9</span></span><span class="pun">][</span><span class="dv"><span class="lit">0</span></span><span class="fu"><span class="pun">-</span></span><span class="dv"><span class="lit">9</span></span><span class="pun">]</span><span class="fu"><span class="pun">*</span></span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="fu"><span class="pln">read</span></span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="dv"><span class="pln">1</span></span><span class="pln"> </span><span class="pun">}</span></code></pre>
</article><article><h3>Javaスタイルのネストコメント</h3>
<pre class="noprettyprint sourceCode"><code class="sourceCode haskell"><span class="ot"><span class="pln">program </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="pun">()</span><br><span class="pln">  </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="pun">(</span><span class="fu"><span class="pun">!</span></span><span class="st"><span class="str">"/*"</span></span><span class="pln"> </span><span class="fu"><span class="pun">!</span></span><span class="st"><span class="str">"*/"</span></span><span class="pln"> </span><span class="fu"><span class="pun">.</span></span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="fu"><span class="pun">/</span></span><span class="pln"> comment</span><span class="pun">)</span><span class="fu"><span class="pun">*</span></span><span class="pln"> </span><span class="fu"><span class="pun">!.</span></span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><br><br><span class="ot"><span class="pln">comment </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="pun">()</span><br><span class="pln">  </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="st"><span class="str">"/*"</span></span><span class="pln"> commentElem</span><span class="fu"><span class="pun">*</span></span><span class="pln"> </span><span class="st"><span class="str">"*/"</span></span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><br><br><span class="ot"><span class="pln">commentElem </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="pun">()</span><br><span class="pln">  </span><span class="fu"><span class="pun">=</span></span><span class="pln"> comment</span><br><span class="pln">  </span><span class="fu"><span class="pun">/</span></span><span class="pln"> </span><span class="fu"><span class="pun">!</span></span><span class="st"><span class="str">"*/"</span></span><span class="pln"> </span><span class="fu"><span class="pun">.</span></span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span></code></pre>
<p>これがflexとかだと意外と難しい</p></article><article><h3>Unquoter</h3><ul><li>Quoterの中で、式を評価させる</li></ul>
<pre class="noprettyprint sourceCode"><code class="sourceCode haskell"><span class="ot"><span class="pln">tensor </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">Exp</span></span><br><span class="pln">  </span><span class="fu"><span class="pun">=</span></span><span class="pln"> ident </span><span class="ch"><span class="str">'_'</span></span><span class="pln"> ident </span><span class="pun">{</span><span class="pln"> </span><span class="fu"><span class="pln">$$</span></span><span class="dv"><span class="pln">1</span></span><span class="pln"> </span><span class="fu"><span class="pun">!!</span></span><span class="pln"> </span><span class="fu"><span class="pln">$$</span></span><span class="dv"><span class="pln">2</span></span><span class="pln"> </span><span class="pun">}</span><br><span class="ot"><span class="pln">ident </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="typ">String</span></span><br><span class="pln">  </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="pun">[</span><span class="pln">a</span><span class="fu"><span class="pun">-</span></span><span class="pln">z</span><span class="pun">]</span><span class="fu"><span class="pun">+</span></span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="fu"><span class="pln">$</span></span><span class="dv"><span class="pln">1</span></span><span class="pln"> </span><span class="pun">}</span></code></pre>

<pre class="noprettyprint sourceCode"><code class="sourceCode haskell"><span class="ot"><span class="pln">main </span></span><span class="ot"><span class="pun">::</span></span><span class="pln"> </span><span class="dt"><span class="pln">IO</span></span><span class="pln"> </span><span class="pun">()</span><br><span class="pln">main </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="kw"><span class="kwd">do</span></span><br><span class="pln">  </span><span class="kw"><span class="pln">let</span></span><span class="pln"> x </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="pun">[</span><span class="dv"><span class="lit">1</span></span><span class="pun">,</span><span class="pln"> </span><span class="dv"><span class="lit">2</span></span><span class="pun">,</span><span class="pln"> </span><span class="dv"><span class="lit">3</span></span><span class="pun">]</span><br><span class="pln">      i </span><span class="fu"><span class="pun">=</span></span><span class="pln"> </span><span class="dv"><span class="lit">1</span></span><br><span class="pln">  </span><span class="fu"><span class="kwd">print</span></span><span class="pln"> </span><span class="pun">[</span><span class="pln">tensor</span><span class="fu"><span class="pun">|</span></span><span class="pln">x_i</span><span class="fu"><span class="pun">|</span></span><span class="pun">]</span></code></pre>
</article><article><h3>いろいろ例&nbsp;(1)</h3><ul><li>Json<ul><li><a href="https://github.com/tanakh/Peggy/blob/master/example/Json.hs" alt="">https://github.com/tanakh/Peggy/blob/master/example/Json.hs</a></li></ul></li><li>MessagePack&nbsp;IDL<ul><li><a href="https://github.com/msgpack/msgpack-haskell/blob/master/msgpack-idl/Language/MessagePack/IDL/Parser.hs" alt="">https://github.com/msgpack/msgpack-haskell/blob/master/msgpack-idl/Language/MessagePack/IDL/Parser.hs</a></li></ul></li></ul></article><article><h3>いろいろ例&nbsp;(2)</h3><ul><li>PeggyのPeggy自身による定義<ul><li><a href="https://github.com/tanakh/Peggy/blob/master/bootstrap/peggy.peggy" alt="">https://github.com/tanakh/Peggy/blob/master/bootstrap/peggy.peggy</a></li></ul></li><li>実際にこれを用いてブートストラップしています。<ul><li><a href="https://github.com/tanakh/Peggy/blob/master/Text/Peggy/Parser.hs" alt="">https://github.com/tanakh/Peggy/blob/master/Text/Peggy/Parser.hs</a></li></ul></li></ul><p><img src="haskell-bnk-peggy-2011-12-16_files/ningen.png" alt="" class="centered"></p></article><article><h3>さらなる例</h3><p>レポジトリの&nbsp;example&nbsp;ディレクトリに色々あります</p><p><a href="https://github.com/tanakh/Peggy/tree/master/example" alt="">https://github.com/tanakh/Peggy/tree/master/example</a></p></article><article><h3>Future&nbsp;works</h3><ul><li>Peggy自体のUnquoter化</li><li>型推論</li><li>Unquoterにちゃんとした型をつける</li><li>Unquoterが多分バグバグなので何とかする<ul><li>Unquoterを生成するパーザを生成するUnquoterを生成するパーザ</li><li>型がややこしすぎて頭がパンクしそうです(´&gt;_&lt;`)</li></ul></li><li>他の言語のパーザ生成<ul><li>Java,&nbsp;C++,&nbsp;etc...</li></ul></li></ul></article><article><h3>Resources</h3><ul><li>Homepage<ul><li><a href="http://tanakh.github.com/Peggy/" alt="">http://tanakh.github.com/Peggy/</a></li></ul></li><li>Source&nbsp;Repository<ul><li><a href="https://github.com/tanakh/peggy" alt="">https://github.com/tanakh/peggy</a></li></ul></li><li>Hackage&nbsp;and&nbsp;Haddock&nbsp;documents<ul><li><a href="http://hackage.haskell.org/package/peggy" alt="">http://hackage.haskell.org/package/peggy</a></li></ul></li></ul></article><article><h3>Try&nbsp;and&nbsp;Fork&nbsp;it!!</h3>
<pre class="noprettyprint sourceCode"><code class="sourceCode bash"><span class="pln">$ cabal update</span><br><span class="pln">$ cabal </span><span class="kw"><span class="pln">install</span></span><span class="pln"> peggy</span></code></pre>
<p><img src="haskell-bnk-peggy-2011-12-16_files/tumblr_lr0zgaGkb81qmcfk5.jpg" alt="" class="centered"></p></article><article><h3></h3><br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<br><center>ご清聴ありがとうございました</center>

</article><div id="prev-slide-area" class="slide-area"></div><div id="next-slide-area" class="slide-area"></div></section><link href="haskell-bnk-peggy-2011-12-16_files/css.css" type="text/css" rel="stylesheet"><link href="haskell-bnk-peggy-2011-12-16_files/styles.css" type="text/css" rel="stylesheet"><script src="haskell-bnk-peggy-2011-12-16_files/prettify.txt" type="text/javascript"></script></body></html>